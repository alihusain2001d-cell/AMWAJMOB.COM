<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨ -->
<link rel="icon" type="image/png" href="LOGO%20MOB.png">

<!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (iPhone / Android) -->
<link rel="apple-touch-icon" href="LOGO%20MOB.png">

<meta name="apple-mobile-web-app-title" content="Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª">
<meta name="application-name" content="Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª">
<meta name="theme-color" content="#0a4d68">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
}

/* Ù…Ù†Ø¹ Ø§Ù„Ù†Ø³Ø® ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± */
#pricesPage * {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* ========== Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© ========== */
#particles-bg {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #0a4d68 0%, #088395 50%, #05BFDB 100%);
  z-index: -1;
}

.particle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: rgba(255, 255, 255, 0.5);
  border-radius: 50%;
  animation: float 15s infinite ease-in-out;
}

@keyframes float {
  0%, 100% {
    transform: translateY(0) translateX(0);
    opacity: 0.3;
  }
  25% {
    transform: translateY(-30px) translateX(10px);
    opacity: 0.8;
  }
  50% {
    transform: translateY(-10px) translateX(-10px);
    opacity: 0.5;
  }
  75% {
    transform: translateY(-40px) translateX(5px);
    opacity: 0.7;
  }
}

/* ========== Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ========== */
.main-wrapper {
  padding: 18px;
  min-height: 100vh;
  position: relative;
  z-index: 1;
}

.container {
  max-width: 580px;
  margin: auto;
  background: rgba(255, 255, 255, 0.60);
  padding: 18px;
  border-radius: 16px;
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(8px);
}

.logo {
  text-align: center;
  margin-bottom: 12px;
}

.logo img {
  width: 150px;
}

.bigbtn {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: 0;
  margin: 8px 0;
  font-size: 20px;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

.bigbtn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.bigbtn:active {
  transform: translateY(0);
}

.big1 { background: #1e88e5; color: #fff; }
.big2 { background: #6c7d90; color: #fff; }
.big3 { background: #25D366; color: #fff; }

label {
  font-weight: bold;
  font-size: 14px;
  display: block;
  margin-top: 10px;
}

input, select, button {
  width: 100%;
  padding: 10px;
  margin: 6px 0 10px;
  border-radius: 10px;
  border: 1px solid #ccd6e6;
  font-size: 16px;
  box-sizing: border-box;
}

button {
  background: #1e88e5;
  color: #fff;
  border: none;
  cursor: pointer;
}

button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.result {
  background: #e8f4ff;
  padding: 12px;
  border-radius: 10px;
  margin-top: 10px;
}

.result.success { background: #e8f8e8; color: #1b5e20; }
.result.error { background: #fde7e7; color: #b10606; }
.result.pending { background: #fff3cd; color: #856404; }

.footer {
  text-align: center;
  margin-top: 12px;
  font-size: 16px;
}

.whatsapp {
  background: #25D366;
  color: #fff;
  padding: 10px;
  display: block;
  text-align: center;
  border-radius: 10px;
  margin-top: 14px;
  text-decoration: none;
  transition: transform 0.2s;
}

.whatsapp:hover {
  transform: translateY(-2px);
}

.brands-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-top: 16px;
}

.brand {
  cursor: pointer;
  background: #f5f7fa;
  border-radius: 12px;
  padding: 18px 10px;
  text-align: center;
  font-weight: bold;
  transition: all 0.2s ease;
  border: 1px solid #e0e0e0;
}

.brand:hover {
  background: #e9eef5;
  transform: scale(1.02);
}

.brand:active {
  transform: scale(0.98);
  background: #dfe6ef;
}

.brand small {
  display: block;
  font-weight: normal;
  opacity: 0.7;
  margin-top: 4px;
}

.welcome-text {
  text-align: center;
  font-size: 18px;
  color: #1e3a5f;
  margin: 15px 0;
  line-height: 1.8;
}

.section-title {
  text-align: center;
  color: #1e88e5;
  font-size: 22px;
  margin: 15px 0;
}

.info-box {
  background: #f0f7ff;
  padding: 12px;
  border-radius: 10px;
  margin: 10px 0;
  text-align: center;
}

/* ========== Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ========== */
#loadingPage {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 60vh;
  text-align: center;
}

#loadingPage img {
  width: 180px;
  margin-bottom: 20px;
}

.loading-spinner {
  border: 4px solid #e0e0e0;
  border-top: 4px solid #1e88e5;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-text {
  color: #1e88e5;
  font-size: 18px;
  margin-top: 10px;
}

/* Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
@media print {
  #pricesPage {
    display: none !important;
  }
}
</style>
</head>
<body>

<!-- Ù…Ù†Ø¹ Ø§Ù„Ù†Ø³Ø® Ø¨Ø§Ù„Ù…Ø§ÙˆØ³ Ø§Ù„ÙŠÙ…ÙŠÙ† ÙÙŠ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
<script>
document.addEventListener('contextmenu', function(e) {
  if (document.getElementById('pricesPage').style.display !== 'none') {
    e.preventDefault();
    return false;
  }
});

document.addEventListener('keydown', function(e) {
  if (document.getElementById('pricesPage').style.display !== 'none') {
    if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'a' || e.key === 'p')) {
      e.preventDefault();
      return false;
    }
  }
});
</script>

<!-- ========== Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© ========== -->
<div id="particles-bg"></div>

<div class="main-wrapper">
  <div class="container">
    <div class="logo">
      <img src="1622010668024.png" alt="Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª">
    </div>

    <!-- ========== Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ========== -->
    <div id="loadingPage">
      <div class="loading-spinner"></div>
      <div class="loading-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <!-- ========== ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (Ù„Ù„Ø²Ø¨Ø§Ø¦Ù† Ø§Ù„Ø¬Ø¯Ø¯) ========== -->
    <div id="registerPage" style="display:none">
      <h2 class="section-title">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
      <p class="welcome-text">
         Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª<br>
          Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¶Ù…Ø§Ù†
      </p>

      <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
      <input type="text" id="regName" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ">

      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„</label>
      <input type="text" id="regShop" placeholder="Ø§Ø³Ù… Ù…Ø­Ù„Ùƒ Ø£Ùˆ Ø´Ø±ÙƒØªÙƒ">

      <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
      <input type="tel" id="regPhone" placeholder="07xxxxxxxxx">

      <button class="bigbtn big1" id="btnRegister" onclick="submitRegistration()">
        Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
      </button>

      <div id="regResult"></div>

      <div style="text-align:center;margin-top:20px;padding-top:15px;border-top:1px solid #eee;">
        <p style="color:#666;">Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŸ</p>
        <button class="bigbtn big2" onclick="showLoginPage()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      </div>

      <div class="info-box">
        ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±:<br>
        <div style="margin-top:5px;">
          <a href="tel:7696" style="font-weight:bold;color:#1e88e5;display:block;margin:3px 0;">ğŸ“± 7696</a>
          <a href="tel:07709000160" style="font-weight:bold;color:#1e88e5;display:block;margin:3px 0;">ğŸ“± 07709000160</a>
        </div>
      </div>
    </div>

    <!-- ========== ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ========== -->
    <div id="loginPage" style="display:none">
      <h2 class="section-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <p class="welcome-text">
         Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹<br>
        ğŸŒŠ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ù„Ù„Ø¯Ø®ÙˆÙ„
      </p>

      <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
      <input type="tel" id="loginPhone" placeholder="07xxxxxxxxx">

      <button class="bigbtn big1" id="btnLogin" onclick="checkLogin()">
        Ø¯Ø®ÙˆÙ„
      </button>

      <div id="loginResult"></div>

      <div style="text-align:center;margin-top:20px;padding-top:15px;border-top:1px solid #eee;">
        <p style="color:#666;">Ù…Ø§ Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ØŸ</p>
        <button class="bigbtn big3" onclick="showRegisterPage()">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
      </div>
    </div>

    <!-- ========== Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„) ========== -->
    <div id="homePage" style="display:none">
      <div id="welcomeUser" class="info-box" style="font-size:18px;font-weight:bold;"></div>
      
      <button class="bigbtn big1" onclick="openAct()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</button>
      <button class="bigbtn big2" onclick="openChk()">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¶Ù…Ø§Ù†</button>
      <button class="bigbtn big1" onclick="openPrices()">Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø§Øª</button>
      
      <div class="info-box">
        ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±:<br>
        <div style="margin-top:5px;">
          <a href="tel:7696" style="font-weight:bold;color:#1e88e5;display:block;margin:3px 0;">ğŸ“± 7696</a>
          <a href="tel:07709000160" style="font-weight:bold;color:#1e88e5;display:block;margin:3px 0;">ğŸ“± 07709000160</a>
        </div>
        <div style="margin-top:8px;color:#555;">Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª ÙŠØ±Ø­Ø¨ Ø¨ÙƒÙ… ğŸŒŠ</div>
      </div>

      <a href="https://wa.me/9647709000160" target="_blank" class="whatsapp">
        ğŸŸ¢ ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
      </a>

      <button class="bigbtn" style="background:#f44336;margin-top:15px;" onclick="logout()">
        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
      </button>
    </div>

    <!-- ========== ØµÙØ­Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ ========== -->
    <div id="activatePage" style="display:none">
      <button onclick="backHome()" class="bigbtn big2">â¬… Ø±Ø¬ÙˆØ¹</button>
      <h3 class="section-title">ØªÙØ¹ÙŠÙ„ Ø¶Ù…Ø§Ù† Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</h3>

      <label>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</label>
      <input id="name">

      <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
      <input id="phone">

      <label>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
      <input id="invoice">
      
      <label>ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©</label>
      <input id="screenCode" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø®Ù„Ù Ø§Ù„Ø´Ø§Ø´Ø©">
      
      <label>Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø´Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <input id="screenName" placeholder="Ù…Ø«Ø§Ù„: iPhone 11 Pro">
      
      <label>Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
      <select id="type">
        <option value="screen">Ø´Ø§Ø´Ø©</option>
        <option value="battery">Ø¨Ø·Ø§Ø±ÙŠØ©</option>
      </select>

      <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ±ÙƒÙŠØ¨</label>
      <input id="start" readonly>

      <div id="dupMsg" style="display:none;background:#fde7e7;color:#b10606;padding:10px;border-radius:10px;margin:10px 0;"></div>

      <button id="btnActivate" class="bigbtn big1" onclick="sendData()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</button>
      <div id="result"></div>

      <div class="footer">
        ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: <a href="tel:7696" style="font-weight:bold;color:#1e88e5;">7696</a><br>
        Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø±ÙƒÙ… Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª ğŸŒŠ
        <a class="whatsapp" href="https://wa.me/9647709000160" target="_blank">ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</a>
      </div>
    </div>

    <!-- ========== ØµÙØ­Ø© Ø§Ù„ØªØ­Ù‚Ù‚ ========== -->
    <div id="checkPage" style="display:none">
      <button onclick="backHome()" class="bigbtn big2">â¬… Ø±Ø¬ÙˆØ¹</button>
      <h3 class="section-title">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¶Ù…Ø§Ù†</h3>
      <input id="inv" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©">
      <button class="bigbtn big1" onclick="checkWarranty()">Ø¨Ø­Ø«</button>
      <div id="out"></div>
    </div>

    <!-- ========== ØµÙØ­Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± (Ù…Ø­Ù…ÙŠØ©) ========== -->
    <div id="pricesPage" style="display:none">
      <button onclick="backHome()" class="bigbtn big2">â¬… Ø±Ø¬ÙˆØ¹</button>
      <h3 class="section-title">ğŸ”’ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø§Øª</h3>
      
      <div style="background:#fff3cd;padding:8px;border-radius:8px;margin:10px 0;font-size:13px;text-align:center;">
        âš ï¸ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ù„Ø§Ø·Ù„Ø§Ø¹ ÙÙ‚Ø· - Ø§Ù„Ù†Ø³Ø® Ù…Ù…Ù†ÙˆØ¹
      </div>
      
      <input type="text" id="searchInput" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„..." style="width:100%;margin:10px 0;padding:12px;">
      
      <div id="brandsSection">
        <div class="brands-grid">
          <div class="brand" data-brand="Apple" onclick="openBrand(this)">
            Ø§ÙŠÙÙˆÙ†<small>iPhone</small>
          </div>
          <div class="brand" data-brand="Samsung" onclick="openBrand(this)">
            Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬<small>Samsung</small>
          </div>
          <div class="brand" data-brand="Huawei" onclick="openBrand(this)">
            Ù‡ÙˆØ§ÙˆÙŠ<small>Huawei</small>
          </div>
          <div class="brand" data-brand="Xiaomi" onclick="openBrand(this)">
            Ø´Ø§ÙˆÙ…ÙŠ<small>Xiaomi</small>
          </div>
          <div class="brand" data-brand="Redmi,Poco" onclick="openBrand(this)">
            Ø±ÙŠØ¯Ù…ÙŠ + Ø¨ÙˆÙƒÙˆ<small>Redmi & Poco</small>
          </div>
          <div class="brand" data-brand="Infinix,Tecno" onclick="openBrand(this)">
            Ø§Ù†ÙÙ†ÙƒØ³ + ØªÙƒÙ†Ùˆ<small>Infinix & Tecno</small>
          </div>
          <div class="brand" data-brand="Oppo,Realme" onclick="openBrand(this)">
            Ø§ÙˆØ¨Ùˆ + Ø±ÙŠÙ„Ù…ÙŠ<small>Oppo & Realme</small>
          </div>
          <div class="brand" data-brand="Vivo,Wiko" onclick="openBrand(this)">
            ÙÙŠÙÙˆ + ÙˆÙŠÙƒÙˆ<small>Vivo & Wiko</small>
          </div>
          <div class="brand" data-brand="Asus,RedMagic,Google" onclick="openBrand(this)">
            Ø§Ø²ÙˆØ² + Ø±ÙŠØ¯ Ù…Ø§Ø¬Ùƒ + ÙƒÙˆÙƒÙ„<small>Asus â€¢ RedMagic â€¢ Google</small>
          </div>
          <div class="brand" data-brand="ZTE,Alcatel,TCL,Blackview" onclick="openBrand(this)">
            ZTE + Alcatel + TCL<small>ZTE â€¢ Alcatel â€¢ TCL â€¢ Blackview</small>
          </div>
        </div>
      </div>

      <div id="brandPrices" style="display:none">
        <button onclick="backToBrands()" class="bigbtn big2">â¬… Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª</button>
        <div id="brandPricesBox"></div>
      </div>
    </div>

  </div>
</div>

<script>
// ==================== Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© ====================
function createParticles() {
  const bg = document.getElementById('particles-bg');
  const particleCount = 50;
  
  for (let i = 0; i < particleCount; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.left = Math.random() * 100 + '%';
    particle.style.top = Math.random() * 100 + '%';
    particle.style.animationDelay = Math.random() * 15 + 's';
    particle.style.animationDuration = (10 + Math.random() * 10) + 's';
    
    const size = 2 + Math.random() * 4;
    particle.style.width = size + 'px';
    particle.style.height = size + 'px';
    
    bg.appendChild(particle);
  }
}

createParticles();

// ==================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† ====================
const CONFIG = {
  API_URL: "https://script.google.com/macros/s/AKfycbxsJo0LnVGZIHsdiMwjE6i_uXlaWWIGtdTMmDN3q2TrvDG_vdMzIPPXYoj6-bQ11lNJcw/exec",
  API_KEY: "AMWAJ_d5fb3e7a-6534-4afa-8c52-b3d14b2d6d22",
  DEVICE_ID: generateDeviceId()
};

function generateDeviceId() {
  let deviceId = localStorage.getItem('amwaj_device_id');
  if (!deviceId) {
    deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substring(7);
    localStorage.setItem('amwaj_device_id', deviceId);
  }
  return deviceId;
}

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ API
async function secureApiCall(action, data = {}) {
  try {
    const response = await fetch(CONFIG.API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify({
        apiKey: CONFIG.API_KEY,
        action: action,
        identifier: CONFIG.DEVICE_ID,
        ...data
      })
    });
    
    const result = await response.json();
    
    if (!result.success) {
      throw new Error(result.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£');
    }
    
    return result.data;
  } catch (error) {
    console.error('API Error:', error);
    throw error;
  }
}

// ==================== ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ====================
function normalizeNumber(str) {
  if (!str && str !== 0) return "";
  str = String(str);
  return str
    .replace(/[Ù -Ù©]/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©".indexOf(d))
    .replace(/[Û°-Û¹]/g, d => "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(d))
    .replace(/\s/g, "");
}

function normalizePhone(phone) {
  let p = normalizeNumber(phone).replace(/[^0-9]/g, "");
  if (p.startsWith("964")) p = "0" + p.slice(3);
  if (p.startsWith("+964")) p = "0" + p.slice(4);
  if (p.length === 10 && !p.startsWith("0")) p = "0" + p;
  return p;
}

// ==================== Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª ====================
function showPage(pageId) {
  const pages = ["loadingPage", "registerPage", "loginPage", "homePage", "activatePage", "checkPage", "pricesPage"];
  pages.forEach(p => {
    const el = document.getElementById(p);
    if (el) el.style.display = "none";
  });
  const target = document.getElementById(pageId);
  if (target) target.style.display = pageId === "loadingPage" ? "flex" : "block";
}

function showRegisterPage() { showPage("registerPage"); }
function showLoginPage() { showPage("loginPage"); }
function backHome() { showPage("homePage"); }

function openAct() {
  showPage("activatePage");
  document.getElementById("start").value = formatDate(new Date());
}
function openChk() { showPage("checkPage"); }
function openPrices() {
  showPage("pricesPage");
  document.getElementById("brandsSection").style.display = "block";
  document.getElementById("brandPrices").style.display = "none";
  
  const searchInput = document.getElementById("searchInput");
  searchInput.value = "";
  
  searchInput.oninput = function() {
    const q = this.value.trim().toLowerCase();
    
    if (q.length < 2) {
      document.getElementById("brandsSection").style.display = "block";
      document.getElementById("brandPrices").style.display = "none";
      return;
    }
    
    document.getElementById("brandsSection").style.display = "none";
    document.getElementById("brandPrices").style.display = "block";
    
    const box = document.getElementById("brandPricesBox");
    box.innerHTML = `<h3 style="color:#1e88e5;margin:10px 0;">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«: "${q}"</h3>`;
    
    const filtered = pricesData.filter(p => 
      (p.name && p.name.toLowerCase().includes(q)) ||
      (p.brand && p.brand.toLowerCase().includes(q))
    );
    
    if (filtered.length === 0) {
      box.innerHTML += "<div style='padding:10px;color:#666;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>";
      return;
    }
    
    filtered.slice(0, 50).forEach(p => {
      box.innerHTML += createPriceItem(p);
    });
    
    if (filtered.length > 50) {
      box.innerHTML += `<div style="padding:10px;color:#666;text-align:center;">... Ùˆ ${filtered.length - 50} Ù†ØªÙŠØ¬Ø© Ø£Ø®Ø±Ù‰</div>`;
    }
  };
}

// ==================== ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ ====================
async function submitRegistration() {
  const btn = document.getElementById("btnRegister");
  const result = document.getElementById("regResult");
  
  const name = document.getElementById("regName").value.trim();
  const shop = document.getElementById("regShop").value.trim();
  const phone = normalizePhone(document.getElementById("regPhone").value);

  if (!name || !shop || !phone) {
    result.innerHTML = '<div class="result error">âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„</div>';
    return;
  }

  if (phone.length < 11) {
    result.innerHTML = '<div class="result error">âŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­</div>';
    return;
  }

  btn.disabled = true;
  btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

  try {
    const rows = await fetchCustomers();
    const existing = rows.find(r => normalizePhone(r.phone) === phone);
    
    if (existing) {
      if (existing.status === "approved") {
        localStorage.setItem("amwaj_phone", phone);
        result.innerHTML = '<div class="result success">âœ… Ø±Ù‚Ù…Ùƒ Ù…Ø³Ø¬Ù„ ÙˆÙ…ÙØ¹Ù„! ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>';
      } else if (existing.status === "pending") {
        localStorage.setItem("amwaj_phone", phone);
        result.innerHTML = '<div class="result pending">â³ Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</div>';
      } else {
        result.innerHTML = '<div class="result error">âŒ ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨Ùƒ Ø³Ø§Ø¨Ù‚Ø§Ù‹ØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„Ù„Ù…Ø²ÙŠØ¯</div>';
      }
      btn.disabled = false;
      btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
      return;
    }

    const date = formatDate(new Date());
    await secureApiCall('addCustomer', {
      name,
      shop,
      phone,
      date,
      status: 'pending'
    });

    localStorage.setItem("amwaj_phone", phone);

    result.innerHTML = `
      <div class="result success">
        âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!<br>
        Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ ÙˆØ§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹<br>
        ğŸ“± Ø±Ù‚Ù…Ùƒ: <b>${phone}</b>
      </div>
    `;
    
    document.getElementById("regName").value = "";
    document.getElementById("regShop").value = "";
    document.getElementById("regPhone").value = "";

  } catch (e) {
    console.error(e);
    result.innerHTML = '<div class="result error">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>';
  }

  btn.disabled = false;
  btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
}

// ==================== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ====================
async function checkLogin() {
  const result = document.getElementById("loginResult");
  const phone = normalizePhone(document.getElementById("loginPhone").value);

  if (!phone || phone.length < 11) {
    result.innerHTML = '<div class="result error">âŒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­</div>';
    return;
  }

  showPage("loadingPage");
  
  const timeoutId = setTimeout(() => {
    showPage("loginPage");
    result.innerHTML = '<div class="result error">âŒ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‡Ù„Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>';
  }, 10000);

  try {
    const rows = await fetchCustomers();
    clearTimeout(timeoutId);
    
    const user = rows.find(r => normalizePhone(r.phone) === phone);

    if (!user) {
      showPage("loginPage");
      result.innerHTML = '<div class="result error">âŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± Ù…Ø³Ø¬Ù„<br>Ø³Ø¬Ù„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ø£ÙˆÙ„Ø§Ù‹</div>';
    } else if (user.status === "approved") {
      localStorage.setItem("amwaj_user", JSON.stringify(user));
      localStorage.setItem("amwaj_phone", phone);
      
      document.getElementById("welcomeUser").innerHTML = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name} ğŸ‘‹<br><small>${user.shop}</small>`;
      showPage("homePage");
      result.innerHTML = "";
    } else if (user.status === "pending") {
      localStorage.setItem("amwaj_phone", phone);
      showPage("loginPage");
      result.innerHTML = '<div class="result pending">â³ Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©<br>Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆØ­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹</div>';
    } else {
      showPage("loginPage");
      result.innerHTML = '<div class="result error">âŒ ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨Ùƒ<br>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</div>';
    }
  } catch (e) {
    clearTimeout(timeoutId);
    console.error(e);
    showPage("loginPage");
    result.innerHTML = '<div class="result error">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>';
  }
}

// ==================== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ====================
function logout() {
  localStorage.removeItem("amwaj_user");
  localStorage.removeItem("amwaj_phone");
  document.getElementById("loginPhone").value = "";
  document.getElementById("loginResult").innerHTML = "";
  showPage("loginPage");
}

// ==================== Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† ====================
async function fetchCustomers() {
  return await secureApiCall('getCustomers');
}

// ==================== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© ====================
async function checkAutoLogin() {
  showPage("loadingPage");
  
  const savedPhone = localStorage.getItem("amwaj_phone");
  
  if (savedPhone) {
    try {
      const rows = await fetchCustomers();
      const user = rows.find(r => normalizePhone(r.phone) === savedPhone);
      
      if (user && user.status === "approved") {
        localStorage.setItem("amwaj_user", JSON.stringify(user));
        document.getElementById("welcomeUser").innerHTML = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name} ğŸ‘‹<br><small>${user.shop}</small>`;
        showPage("homePage");
        return;
      } else if (user && user.status === "pending") {
        document.getElementById("loginPhone").value = savedPhone;
        showPage("loginPage");
        document.getElementById("loginResult").innerHTML = '<div class="result pending">â³ Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©<br>Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</div>';
        return;
      } else if (user && user.status === "rejected") {
        localStorage.removeItem("amwaj_phone");
        localStorage.removeItem("amwaj_user");
        showPage("loginPage");
        return;
      } else {
        localStorage.removeItem("amwaj_phone");
        localStorage.removeItem("amwaj_user");
        showPage("registerPage");
        return;
      }
    } catch (e) {
      console.error(e);
      showPage("registerPage");
      return;
    }
  }
  
  showPage("registerPage");
}

// ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¶Ù…Ø§Ù† ====================
function formatDate(d) {
  let x = new Date(d);
  return String(x.getDate()).padStart(2, '0') + "/" + String(x.getMonth() + 1).padStart(2, '0') + "/" + x.getFullYear();
}

let usedInvoices = new Set();

async function sendData() {
  const btn = document.getElementById("btnActivate");
  const result = document.getElementById("result");
  const dupMsg = document.getElementById("dupMsg");

  btn.disabled = true;
  btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„â€¦";
  dupMsg.style.display = "none";

  try {
    let name = document.getElementById("name").value.trim();
    let phone = document.getElementById("phone").value.trim();
    let screenName = document.getElementById("screenName").value.trim();
    let invoice = normalizeNumber(document.getElementById("invoice").value.trim());
    let screenCode = normalizeNumber(document.getElementById("screenCode").value).trim().toUpperCase();
    let type = document.getElementById("type").value;
    let start = document.getElementById("start").value;

    if (!name || !phone || !invoice || !screenCode) {
      alert("Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
      throw "stop";
    }

    if (usedInvoices.has(screenCode)) {
      dupMsg.innerText = "âš ï¸ ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹";
      dupMsg.style.display = "block";
      throw "stop";
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¶Ù…Ø§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
    const warranties = await secureApiCall('getWarranties');
    if (warranties.find(w => normalizeNumber(String(w.screencode || "")).trim().toUpperCase() === screenCode)) {
      dupMsg.innerText = "âš ï¸ ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹";
      dupMsg.style.display = "block";
      throw "stop";
    }

    let days = type === "screen" ? 30 : 365;
    let [d, m, y] = start.split("/");
    let end = new Date(y, m - 1, d);
    end.setDate(end.getDate() + days);

    let remaining = Math.ceil((end - new Date()) / (1000 * 60 * 60 * 24));

    result.className = "result success";
    result.style.display = "block";
    result.innerHTML = `
      âœ”ï¸ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†<br>
      ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: <b>${formatDate(end)}</b><br>
      â³ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <b>${remaining}</b> ÙŠÙˆÙ…
      <div style="margin-top:10px;padding:8px 12px;background:#fff3cd;color:#856404;border-radius:8px;font-size:14px;">
        âš ï¸ Ø§Ù„Ø¶Ù…Ø§Ù† Ù„Ø§ ÙŠØ´Ù…Ù„ Ø§Ù„ÙƒØ³Ø±ØŒ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ØŒ Ø£Ùˆ Ø§Ù„ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø®Ø§Ø·Ø¦<br>
        Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¬Ø²Ø¡ Ù…Ù† Ø¶Ù…Ø§Ù†ÙƒÙ…ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù‡Ø§
      </div>
    `;

    // âœ… Ø¥Ø±Ø³Ø§Ù„ Ù„Ù€ Apps Script Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Pipedream
    await secureApiCall('addWarranty', {
      name,
      phone,
      invoice,
      screenCode,
      screenName,
      type,
      start,
      end: formatDate(end)
    });

    usedInvoices.add(screenCode);
    btn.innerText = "ØªÙ… âœ”ï¸";

  } catch (e) {
    if (e !== "stop") console.error(e);
    btn.innerText = "ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†";
    btn.disabled = false;
  }
}

async function checkWarranty() {
  let v = normalizeNumber(document.getElementById("inv").value).trim().toUpperCase();
  let out = document.getElementById("out");
  
  if (!v) {
    alert("Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©");
    return;
  }

  out.innerHTML = '<div class="result pending">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</div>';

  try {
    const warranties = await secureApiCall('getWarranties');
    const r = warranties.find(w => normalizeNumber(String(w.screencode || "")).trim().toUpperCase() === v);

    if (r) {
      let [d, m, y] = String(r.end).split("/");
      let end = new Date(y, m - 1, d);
      let remaining = Math.ceil((end - new Date()) / (1000 * 60 * 60 * 24));
      out.innerHTML = `
        <div class="result success">
          âœ”ï¸ Ø§Ù„Ø¶Ù…Ø§Ù† Ù…ÙˆØ¬ÙˆØ¯<br>
          Ø§Ù„Ø§Ø³Ù…: ${r.name || "-"}<br>
          Ø§Ù„Ù‡Ø§ØªÙ: ${r.phone || "-"}<br>
          Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø´Ø©: ${r.screenname || "-"}<br>
          Ø§Ù„Ù†ÙˆØ¹: ${r.type || "-"}<br>
          Ø§Ù„Ø¨Ø¯Ø¡: ${r.start || "-"}<br>
          Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: ${r.end || "-"}<br>
          ${remaining >= 0 ? `â³ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <b>${remaining}</b> ÙŠÙˆÙ…` : "âŒ Ø§Ù„Ø¶Ù…Ø§Ù† Ù…Ù†ØªÙ‡ÙŠ"}
        </div>
      `;
    } else {
      out.innerHTML = '<div class="result error">âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©</div>';
    }
  } catch (e) {
    console.error(e);
    out.innerHTML = '<div class="result error">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message + '</div>';
  }
}

// ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ====================
let pricesData = [];

async function loadPrices() {
  try {
    pricesData = await secureApiCall('getPrices');
    console.log("âœ… Prices loaded:", pricesData.length);
  } catch (e) {
    console.error("Error loading prices:", e);
  }
}

function formatPriceIQD(n) {
  let priceStr = String(n || '').replace(/\s/g, '').replace(/,/g, '').replace(/\./g, '');
  const price = Number(priceStr) || 0;
  return price.toLocaleString("de-DE");
}

function createPriceItem(p) {
  let priceStr = String(p.price || '').replace(/\s/g, '').replace(/,/g, '').replace(/\./g, '');
  const price = Number(priceStr) || 0;
  const qty = Number(p.qty) || 0;
  
  return `
    <div class="price-item" style="padding:12px;border:1px solid #ccc;margin:8px 0;border-radius:10px;background:#f9fbff">
      <div style="font-weight:bold;font-size:16px;color:#1e3a5f">
        <div style="margin-top:4px"><b>Ø§Ù„Ù…Ø§Ø±ÙƒØ©:</b> ${p.brand || "-"}</div>
        <div style="margin-top:4px"><b>Ø§Ù„Ø§Ø³Ù…:</b> ${p.name || "-"}</div>
        <div style="margin-top:4px"><b>Ø§Ù„Ù†ÙˆØ¹:</b> ${p.type || "-"}</div>
        <div style="margin-top:4px"><b>Ø§Ù„Ø³Ø¹Ø±:</b>
          ${qty > 0 && price > 0
            ? `<span style="color:#1e88e5;font-weight:bold">${formatPriceIQD(price)} Ø¯.Ø¹</span>`
            : `<span style="color:#c62828;font-weight:bold">ØºÙŠØ± Ù…ØªÙˆÙØ±</span>`
          }
        </div>
      </div>
    </div>
  `;
}

function openBrand(el) {
  const brands = el.dataset.brand.split(",").map(b => b.trim());

  document.getElementById("brandsSection").style.display = "none";
  document.getElementById("brandPrices").style.display = "block";

  const box = document.getElementById("brandPricesBox");
  box.innerHTML = `<h3 style="color:#1e88e5;margin:10px 0;">Ø£Ø³Ø¹Ø§Ø± ${brands.join(" / ")}</h3>`;

  const searchInput = document.getElementById("searchInput");
  searchInput.value = "";

  searchInput.oninput = function() {
    const q = this.value.trim().toLowerCase();
    const items = box.querySelectorAll(".price-item");
    items.forEach(item => {
      const text = item.innerText.toLowerCase();
      item.style.display = text.includes(q) ? "block" : "none";
    });
  };

  const filtered = pricesData.filter(p =>
    brands.map(b => b.toLowerCase()).includes((p.brand || "").toLowerCase())
  );

  if (filtered.length === 0) {
    box.innerHTML += "<div style='padding:10px'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¹Ø§Ø±</div>";
    return;
  }

  filtered.forEach(p => {
    box.innerHTML += createPriceItem(p);
  });
}

function backToBrands() {
  document.getElementById("brandPrices").style.display = "none";
  document.getElementById("brandsSection").style.display = "block";
}

// ==================== ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© ====================
checkAutoLogin();
loadPrices();
</script>

</body>
</html>
