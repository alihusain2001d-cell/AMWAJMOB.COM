<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>تفعيل ضمان أمواج</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: sans-serif;
  padding: 15px;
}
label{font-weight: bold}
input,select,button{
  width:100%;
  padding:8px;
  margin:6px 0 15px;
}
button{
  background:#1e88e5;
  color:#fff;
  border:none;
  border-radius:6px;
}
</style>
</head>

<body>

<h3>تفعيل ضمان أمواج للإلكترونيات</h3>
<p>الرجاء إدخال البيانات لتفعيل الضمان:</p>

<label>اسم الزبون</label>
<input id="name" type="text">

<label>رقم الهاتف</label>
<input id="phone" type="text">

<label>رقم الفاتورة</label>
<input id="invoice" type="text">

<label>نوع القطعة</label>
<select id="type">
  <option value="screen">شاشة</option>
  <option value="battery">بطارية</option>
</select>

<label>تاريخ التركيب</label>
<input id="start" type="date">

<button onclick="sendData()">تفعيل الضمان</button>

<script>
function sendData(){

  const data = {
    name: document.getElementById("name").value.trim(),
    phone: document.getElementById("phone").value.trim(),
    invoice: document.getElementById("invoice").value.trim(),
    type: document.getElementById("type").value,
    start: document.getElementById("start").value
  };

  if(!data.name || !data.phone || !data.invoice || !data.start){
    alert("الرجاء إدخال جميع الحقول");
    return;
  }

  console.log(data);

  fetch("https://eo9txe5hkh3d1yk.m.pipedream.net", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
.then(msg => {

  // نعرض رسالة نجاح
  alert("تم تفعيل الضمان بنجاح");

  // نحسب مدة الضمان حسب النوع
  let months = (data.type === "screen") ? 1 : 12;

  // تاريخ انتهاء الضمان
  let expiry = new Date(data.start);
  expiry.setMonth(expiry.getMonth() + months);

  // نعرض العدّاد
  const box = document.createElement("div");
  box.style =
    "margin-top:15px;padding:12px;border-radius:10px;border:1px solid #8cd2ff;background:#e8f7ff;font-size:18px;font-weight:bold";

  document.body.appendChild(box);

  function tick() {
    let now = new Date();
    let diff = expiry - now;

    if (diff <= 0) {
      box.innerHTML = "انتهى الضمان";
      return;
    }

    let d = Math.floor(diff / (1000 * 60 * 60 * 24));
    let h = Math.floor((diff / (1000 * 60 * 60)) % 24);
    let m = Math.floor((diff / (1000 * 60)) % 60);
    let s = Math.floor((diff / 1000) % 60);

    box.innerHTML =
      `الوقت المتبقي: ${d} يوم — ${h}:${m}:${s}`;
  }

  tick();
  setInterval(tick, 1000);

})
.catch(() => alert("حدث خطأ — حاول مرة أخرى"));
}
</script>

</body>
</html>
</script>

</body>
</html>
