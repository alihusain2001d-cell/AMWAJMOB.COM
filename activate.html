<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>ØªÙØ¹ÙŠÙ„ Ø¶Ù…Ø§Ù† Ø£Ù…ÙˆØ§Ø¬</title>

<style>
body{font-family:sans-serif;background:#eef6ff;padding:18px}
.container{max-width:520px;margin:auto;background:#fff;padding:18px;border-radius:14px;box-shadow:0 10px 25px rgba(0,0,0,.08)}

.logo{text-align:center;margin-bottom:12px}
.logo img{width:130px}

button{width:100%;padding:10px;border-radius:8px;border:0}
.blue{background:#1e88e5;color:#fff}
.green{background:#25D366;color:#fff}

.msg{margin-top:10px;padding:10px;border-radius:10px;display:none;font-weight:bold}
.err{background:#ffe8e8;color:#b00000;border:1px solid #ffb4b4}
.ok{background:#e8fff1;color:#0a7a2d;border:1px solid #a8e2c3}
</style>
</head>

<body>

<div class="container">

<div class="logo">
  <img src="1633875906547.jpg">
</div>

<button class="blue" onclick="showForm()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</button>
<button class="blue" style="margin-top:8px" onclick="showSearch()">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¶Ù…Ø§Ù†</button>

<div id="formBox" style="margin-top:14px;display:none">

  <h3>ØªÙØ¹ÙŠÙ„ Ø¶Ù…Ø§Ù† Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</h3>

  <label>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</label>
  <input id="name">

  <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
  <input id="phone">

  <label>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
  <input id="invoice">

  <label>Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
  <select id="type">
    <option value="screen">Ø´Ø§Ø´Ø©</option>
    <option value="battery">Ø¨Ø·Ø§Ø±ÙŠØ©</option>
  </select>

  <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ±ÙƒÙŠØ¨ (Ø§Ù„ÙŠÙˆÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)</label>
  <input id="start" readonly>

  <div id="warn" class="msg err"></div>
  <div id="result" class="msg ok"></div>

  <button id="btn" class="blue" onclick="sendData()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</button>

  <p dir="rtl" style="margin-top:10px;font-weight:bold">
    â˜ï¸ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: <span style="font-size:17px">7696</span><br>
    Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø±ÙƒÙ… Ø£Ù…ÙˆØ§Ø¬ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¬ÙˆØ§Ù„Ø© ğŸŒŠ
  </p>

  <a class="green" href="https://wa.me/9647709000160" target="_blank">ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</a>

</div>

</div>

<script>
const SHEET =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTraFUR-pqdM1dR-syL2zyxSNuQvDhNRnk95BkjBecronw6tB0jvAISLAMRuZpTIrLSp2DkeX-ElqUQ/pub?output=csv";

const hook = "https://eo9txe5hkh3d1yk.m.pipedream.net";

document.getElementById("start").value =
  new Date().toISOString().slice(0,10).split("-").reverse().join("/");

function showForm(){formBox.style.display="block";}
function showSearch(){window.location.href="search.html";}

// Ù…Ù†Ø¹ Ø§Ù„Ø¶ØºØ· Ù…Ø±ØªÙŠÙ†
let sending = false;

async function sendData(){

  if(sending) return;
  sending = true;
  btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
  warn.style.display="none";
  result.style.display="none";

  const name = nameInput.value?.trim();
  const phone = phoneInput.value?.trim();
  const invoice = invoiceInput.value?.trim();

  if(!name || !phone || !invoice){
    warn.innerHTML="âš  Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„";
    warn.style.display="block";
    reset(); return;
  }

  // ğŸ” ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø± Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù…Ø¹ ÙƒØ³Ø± Ø§Ù„ÙƒØ§Ø´)
  const res = await fetch(SHEET+"?t="+Date.now());
  const text = await res.text();
  const exists = text.split("\n").find(r => r.split(",")[0].trim() === invoice);

  if(exists){
    warn.innerHTML="âš  Ù‡Ø°Ø§ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…ÙØ³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹ â€” Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
    warn.style.display="block";
    reset(); return;
  }

  // Ø¥Ø±Ø³Ø§Ù„
  await fetch(hook,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      name, phone, invoice,
      type: type.value,
      start: start.value
    })
  });

  result.innerHTML="â­ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­";
  result.style.display="block";
  reset();
}

function reset(){
  sending=false;
  btn.innerText="ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†";
}

// Ù…Ø±Ø§Ø¬Ø¹ Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ø¹Ù†Ø§ØµØ±
const nameInput   = document.getElementById("name");
const phoneInput  = document.getElementById("phone");
const invoiceInput= document.getElementById("invoice");
const warn   = document.getElementById("warn");
const result = document.getElementById("result");
const btn    = document.getElementById("btn");
</script>

</body>
</html>
