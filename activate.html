<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ØªÙØ¹ÙŠÙ„ Ø¶Ù…Ø§Ù† Ø£Ù…ÙˆØ§Ø¬</title>

<style>
body{
  font-family: sans-serif;
  padding:15px;
  background:#f3faff;
}
.card{
  background:#fff;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
  box-shadow:0 5px 12px rgba(0,0,0,.08);
}
input,select,button{
  width:100%;
  padding:9px;
  margin:6px 0;
  border-radius:6px;
}
button{
  background:#0099cc;
  color:#fff;
  border:none;
}
.result{
  background:#e8faff;
  padding:10px;
  border-radius:6px;
  margin-top:10px;
}
.whatsapp{
  background:#25d366;
  color:#fff;
  text-align:center;
  display:block;
  margin-top:10px;
  padding:10px;
  border-radius:10px;
  text-decoration:none;
  font-weight:bold;
}
</style>
</head>

<body>

<h3 style="text-align:center">ØªÙØ¹ÙŠÙ„ Ø¶Ù…Ø§Ù† Ø£Ù…ÙˆØ§Ø¬</h3>

<div class="card">

<label>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</label>
<input id="name">

<label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
<input id="phone">

<label>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
<input id="invoice">

<label>Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
<select id="type">
<option value="screen">Ø´Ø§Ø´Ø©</option>
<option value="battery">Ø¨Ø·Ø§Ø±ÙŠØ©</option>
</select>

<label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ±ÙƒÙŠØ¨</label>
<input id="start" type="date">

<button onclick="activate()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</button>

<div id="activeMsg" class="result" style="display:none"></div>

</div>

<div class="card">
<h4>ğŸ” Ø¥Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø¶Ù…Ø§Ù† Ø¨Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h4>

<input id="searchInvoice" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©">
<button onclick="check()">Ø¨Ø­Ø«</button>

<div id="searchMsg" class="result" style="display:none"></div>
</div>

<a class="whatsapp" href="https://wa.me/9647709000160" target="_blank">
ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨: 07709000160
</a>

<p style="text-align:center;opacity:.8">ğŸŒŠ Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø±ÙƒÙ… Ø£Ù…ÙˆØ§Ø¬</p>

<script>

const WEBHOOK = "https://eo9txe5hkh3d1yk.m.pipedream.net";   // Ø±Ø§Ø¨Ø·Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ
const SHEET_ID = "1BiV0ZxQN_ClD1tA7w8W5rfmY1bXfs9oax7Q3oqeXq38";

function daysAdd(date, days){
 let d = new Date(date);
 d.setDate(d.getDate()+days);
 return d.toISOString().split("T")[0];
}

// ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†
async function activate(){

 let data = {
  name: name.value.trim(),
  phone: phone.value.trim(),
  invoice: invoice.value.trim(),
  type: type.value,
  start: start.value
 };

 if(!data.name || !data.phone || !data.invoice || !data.start){
   alert("Ø±Ø¬Ø§Ø¡Ù‹ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
   return;
 }

 // Ù…Ø¯Ø© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø·Ø¹Ø©
 let expiry = (data.type=="screen")
     ? daysAdd(data.start,30)
     : daysAdd(data.start,365);

 // ØªØ£ÙƒØ¯ Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø©
 let exist = await fetch(
 `https://opensheet.elk.sh/${SHEET_ID}/sheet1`
 ).then(r=>r.json());

 if(exist.some(r=>r.invoice==data.invoice)){
   alert("âš  Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…ÙØ³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹");
   return;
 }

 data.expiry = expiry;

 fetch(WEBHOOK,{
  method:"POST",
  headers:{ "Content-Type":"application/json"},
  body:JSON.stringify(data)
 })
 .then(()=>{

   activeMsg.style.display="block";
   activeMsg.innerHTML =
   `ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†<br>
   ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙØ¹ÙŠÙ„: ${data.start}<br>
   Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¶Ù…Ø§Ù†: ${expiry}`;

   invoice.value="";
 })
 .catch(()=>alert("Ø­Ø¯Ø« Ø®Ø·Ø£ â€” Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"));
}


// Ø§Ù„Ø¥Ø³ØªØ¹Ù„Ø§Ù…
async function check(){

 let inv = searchInvoice.value.trim();
 if(!inv){ alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©"); return; }

 let rows = await fetch(
 `https://opensheet.elk.sh/${SHEET_ID}/sheet1`
 ).then(r=>r.json());

 let w = rows.find(x=>x.invoice==inv);

 searchMsg.style.display="block";

 if(!w){
  searchMsg.innerHTML="âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¶Ù…Ø§Ù† Ù„Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…";
 }else{
  searchMsg.innerHTML=
  `âœ” Ø§Ø³Ù…: ${w.name}<br>
   Ù‡Ø§ØªÙ: ${w.phone}<br>
   Ù†ÙˆØ¹: ${w.type}<br>
   ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙØ¹ÙŠÙ„: ${w.start}<br>
   Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¶Ù…Ø§Ù†: ${w.expiry}`;
 }
}

</script>

</body>
</html>
