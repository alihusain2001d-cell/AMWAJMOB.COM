<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>Ø¶Ù…Ø§Ù† Ø£Ù…ÙˆØ§Ø¬</title>

<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>
body{font-family:sans-serif;background:#e9f2fa;padding:16px}
.container{max-width:560px;margin:auto;background:#fff;border-radius:16px;
padding:18px;box-shadow:0 10px 24px rgba(0,0,0,.07)}
.logo{text-align:center;margin-bottom:12px}
.logo img{width:150px}

.bigbtn{
width:100%;padding:14px;border-radius:12px;border:0;
background:#1e88e5;color:#fff;font-size:17px;font-weight:bold;margin:8px 0;
}

section{display:none}
section.active{display:block}

label{font-weight:bold}
input,select{
width:100%;padding:10px;border-radius:10px;border:1px solid #ccd6e6;
margin:6px 0 14px;
}

.action{width:100%;padding:12px;border-radius:10px;border:0;
background:#1e88e5;color:#fff;font-size:15px}

.alert{padding:10px;border-radius:10px;margin-top:10px;font-weight:bold}
.alert-red{background:#fde8e8;color:#9b1c1c}
.alert-green{background:#e8f7e8;color:#0b7a0b}

.info{text-align:center;margin-top:10px;font-weight:bold}
.whatsapp{display:block;text-align:center;background:#25D366;color:#fff;
padding:12px;border-radius:10px;text-decoration:none;margin-top:10px}
</style>
</head>

<body>

<div class="container">

<div class="logo">
  <img src="1633875906547.jpg">
</div>

<section id="home" class="active">
  <button class="bigbtn" onclick="openAct()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</button>
  <button class="bigbtn" style="background:#6c7d90" onclick="openChk()">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¶Ù…Ø§Ù†</button>
</section>

<section id="act">

  <button class="bigbtn" onclick="backHome()">â¬… Ø±Ø¬ÙˆØ¹</button>

  <h3>ØªÙØ¹ÙŠÙ„ Ø¶Ù…Ø§Ù† Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</h3>
  <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†:</p>

  <label>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</label>
  <input id="name">

  <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
  <input id="phone">

  <label>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
  <input id="invoice">

  <label>Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
  <select id="type">
    <option value="screen">Ø´Ø§Ø´Ø©</option>
    <option value="battery">Ø¨Ø·Ø§Ø±ÙŠØ©</option>
  </select>

  <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ±ÙƒÙŠØ¨ (Ø§Ù„ÙŠÙˆÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)</label>
  <input id="start" readonly style="background:#f7f9ff">

  <button id="btnSend" class="action" onclick="sendData()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</button>

  <div id="dupMsg" class="alert alert-red" style="display:none"></div>
  <div id="okMsg" class="alert alert-green" style="display:none"></div>

  <div class="info">
â˜ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 
<a href="tel:7696" style="font-weight:bold;color:#1e88e5;text-decoration:none">7696</a><br>
Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø±ÙƒÙ… Ø£Ù…ÙˆØ§Ø¬ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¬ÙˆØ§Ù„Ø© ğŸŒŠ
  </div>

  <a class="whatsapp" href="https://wa.me/9647709000160" target="_blank">
ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
  </a>

</section>

<section id="chk">

  <button class="bigbtn" onclick="backHome()">â¬… Ø±Ø¬ÙˆØ¹</button>

  <h3>ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¶Ù…Ø§Ù†</h3>

  <input id="inv" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©">
  <button class="action" onclick="check()">Ø¨Ø­Ø«</button>

  <div id="out" class="alert" style="display:none"></div>

</section>

</div>

<script>
const SHEET =
 "https://docs.google.com/spreadsheets/d/e/2PACX-1vTraFUR-pqdM1dR-syL2zyxSNuQvDhNRnk95BkjBecronw6tB0jvAISLAMRuZpTIrLSp2DkeX-ElqUQ/pub?output=csv";

function show(id){
 document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}
function backHome(){show('home')}
function openAct(){show('act')}
function openChk(){show('chk')}

function formatDate(d){
 let dt=new Date(d);
 return String(dt.getDate()).padStart(2,'0')+"/"+
        String(dt.getMonth()+1).padStart(2,'0')+"/"+
        dt.getFullYear();
}
document.getElementById("start").value = formatDate(new Date());

let sending=false;

async function sendData(){

 if(sending) return;          // ğŸ”’ Ù…Ù†Ø¹ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…ØªÙƒØ±Ø±
 sending = true;

 const btn=document.getElementById("btnSend");
 btn.innerText="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
 btn.disabled=true;

 document.getElementById("dupMsg").style.display="none";
 document.getElementById("okMsg").style.display="none";

 const data={
  name:document.getElementById("name").value.trim(),
  phone:document.getElementById("phone").value.trim(),
  invoice:document.getElementById("invoice").value.trim(),
  type:document.getElementById("type").value,
  start:document.getElementById("start").value
 };

 if(!data.name||!data.phone||!data.invoice){
   alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
   resetBtn();
   return;
 }

 // ğŸ” ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø± â€” Ù…Ø¹ ÙƒØ³Ø± Ø§Ù„ÙƒØ§Ø´
 let res=await fetch(SHEET + "?t=" + Date.now());
 let rows=(await res.text()).split("\n").map(r=>r.split(","));

 if(rows.find(r=>String(r[0]).trim()===data.invoice)){
   let d=document.getElementById("dupMsg");
   d.innerHTML="âš  Ù‡Ø°Ø§ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…ÙØ³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹ â€” Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
   d.style.display="block";
   resetBtn();
   return;
 }

 // ØªØ­Ø¯ÙŠØ¯ Ù…Ø¯Ø© Ø§Ù„Ø¶Ù…Ø§Ù†
 let days=data.type==="screen"?30:365;
 let [dd,mm,yy]=data.start.split("/");
 let sDate=new Date(`${yy}-${mm}-${dd}`);
 let exp=new Date(sDate);
 exp.setDate(exp.getDate()+days);

 await fetch("https://eo9txe5hkh3d1yk.m.pipedream.net",{
   method:"POST",
   headers:{"Content-Type":"application/json"},
   body:JSON.stringify(data)
 });

 let ok=document.getElementById("okMsg");
 ok.innerHTML=
   `â­ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­<br>
    ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙØ¹ÙŠÙ„: <b>${data.start}</b><br>
    ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: <b>${formatDate(exp)}</b>`;
 ok.style.display="block";

 resetBtn();

 document.getElementById("name").value="";
 document.getElementById("phone").value="";
 document.getElementById("invoice").value="";
}

function resetBtn(){
 sending=false;
 const btn=document.getElementById("btnSend");
 btn.innerText="ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†";
 btn.disabled=false;
}

// Ø§Ù„ØªØ­Ù‚Ù‚
async function check(){
 let v=document.getElementById("inv").value.trim();
 if(!v) return alert("Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©");

 let res=await fetch(SHEET + "?t=" + Date.now());
 let rows=(await res.text()).split("\n").map(r=>r.split(","));
 let r=rows.find(r=>String(r[0]).trim()===v);

 let out=document.getElementById("out");
 if(!r){
   out.className="alert alert-red";
   out.innerHTML="âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©";
 }else{
   out.className="alert alert-green";
   out.innerHTML=
   `âœ”ï¸ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¶Ù…Ø§Ù†<br>
    Ø§Ù„Ø§Ø³Ù…: ${r[1]}<br>
    Ø§Ù„Ù‡Ø§ØªÙ: ${r[2]}<br>
    Ø§Ù„Ù†ÙˆØ¹: ${r[3]}<br>
    ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡: ${r[4]}<br>
    Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: ${r[5]}`;
 }
 out.style.display="block";
}
</script>

</body>
</html>
