<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ØªÙØ¹ÙŠÙ„ Ø¶Ù…Ø§Ù† Ø£Ù…ÙˆØ§Ø¬</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:sans-serif;padding:15px;background:#f7fbff}
.container{max-width:520px;margin:auto;background:#fff;padding:18px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
.logo{text-align:center;margin-bottom:15px}
.logo img{width:130px}
h3{text-align:center;margin-top:0}
label{font-weight:bold}
input,select,button{width:100%;padding:8px;margin:6px 0 14px}
button{background:#1e88e5;color:#fff;border:none;border-radius:6px}
.result{background:#e8f4ff;padding:12px;border-radius:8px;margin-top:12px;display:none}
.footer{text-align:center;margin-top:15px;color:#333}
.timer-box{background:#f5fbf2;border:1px solid #d6efcb;margin-top:10px;padding:10px;border-radius:10px;font-weight:bold}
.whatsapp{background:#25D366;color:#fff;padding:10px;display:block;text-align:center;border-radius:6px;margin-top:15px;text-decoration:none}
.search-box{background:#eef6ff;border:1px solid #cfe2ff;padding:10px;border-radius:10px;margin-top:15px}
</style>
</head>

<body>

<div class="container">

<div class="logo">
  <img src="1633875906547.jpg">
</div>

<h3>ØªÙØ¹ÙŠÙ„ Ø¶Ù…Ø§Ù† Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</h3>

<label>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</label>
<input id="name" type="text">

<label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
<input id="phone" type="text">

<label>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
<input id="invoice" type="text">

<label>Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
<select id="type">
  <option value="screen">Ø´Ø§Ø´Ø©</option>
  <option value="battery">Ø¨Ø·Ø§Ø±ÙŠØ©</option>
</select>

<label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ±ÙƒÙŠØ¨</label>
<input id="start" type="date">

<button onclick="sendData()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</button>

<div id="result" class="result"></div>

<div class="search-box">
  <b>ğŸ” Ø¥Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø¶Ù…Ø§Ù† Ø¨Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</b><br>
  <input id="searchInvoice" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©">
  <button onclick="search()">Ø¨Ø­Ø«</button>
  <div id="searchResult" style="margin-top:10px;"></div>
</div>

<div style="text-align:center; margin-top:15px; font-weight:bold;">
ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: <a href="tel:7696" style="text-decoration:none;color:#1e88e5;">7696</a>
</div>

<div class="footer">
Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø±ÙƒÙ… <b>Ø£Ù…ÙˆØ§Ø¬ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¬ÙˆØ§Ù„Ø©</b> ğŸŒŠ
</div>

<a class="whatsapp" href="https://wa.me/9647709000160" target="_blank">
ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
</a>

</div>

<script>

// Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙˆÙ„ (CSV)
const SHEET =
 "https://docs.google.com/spreadsheets/d/1BiV0ZxQN_ClD1tA7w8W5rfmY1bXfs9oax7Q3oqeXq38/export?format=csv";

// Ù‚Ø±Ø§Ø¡Ø© CSV Ø¨Ø³ÙŠØ·
async function getRows(){
  const res = await fetch(SHEET);
  const text = await res.text();
  const lines = text.trim().split("\n").map(r=>r.split(","));
  const headers = lines.shift();
  return lines.map(r=>{
    let obj={};
    headers.forEach((h,i)=>obj[h]=r[i]);
    return obj;
  });
}

// Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± + Ø§Ù„ØªÙØ¹ÙŠÙ„
async function sendData(){

  const data = {
    name: document.getElementById("name").value.trim(),
    phone: document.getElementById("phone").value.trim(),
    invoice: document.getElementById("invoice").value.trim(),
    type: document.getElementById("type").value,
    start: document.getElementById("start").value
  };

  if(!data.name || !data.phone || !data.invoice || !data.start){
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
    return;
  }

  // ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø±
  const rows = await getRows();
  if(rows.some(r => r.invoice == data.invoice)){
    alert("âš  Ù‡Ø°Ø§ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹");
    return;
  }

  // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
  let days = data.type === "screen" ? 30 : 365;
  const startDate = new Date(data.start);
  const expiry = new Date(startDate);
  expiry.setDate(expiry.getDate()+days);
  data.expiry = expiry.toISOString().slice(0,10);

  // Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬Ø©
  document.getElementById("result").style.display="block";
  document.getElementById("result").innerHTML = `
    â­ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­ â­<br><br>
    ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙØ¹ÙŠÙ„: <b>${data.start}</b><br>
    Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¶Ù…Ø§Ù†: <b>${data.expiry}</b>
    <div id="timer" class="timer-box"></div>
  `;

  setInterval(()=>{
    const diff = expiry - new Date();
    if(diff<=0){document.getElementById("timer").innerHTML="âš  Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¶Ù…Ø§Ù†";return;}
    const daysLeft = Math.floor(diff/(1000*60*60*24));
    document.getElementById("timer").innerHTML = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <b>${daysLeft}</b> ÙŠÙˆÙ…`;
  },1000);

  // Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„
  fetch("https://eo9txe5hkh3d1yk.m.pipedream.net",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(data)
  });
}

// Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©
async function search(){
  const id = document.getElementById("searchInvoice").value.trim();
  if(!id){alert("Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©");return;}

  const rows = await getRows();
  const row = rows.find(r=>r.invoice==id);

  if(!row){
    document.getElementById("searchResult").innerHTML = "âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¶Ù…Ø§Ù† Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…";
    return;
  }

  document.getElementById("searchResult").innerHTML = `
    âœ” Ù…ÙˆØ¬ÙˆØ¯ â€” Ø§Ù„Ø§Ø³Ù…: <b>${row.name}</b><br>
    Ø§Ù„Ù‡Ø§ØªÙ: ${row.phone}<br>
    Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø©: ${row.type}<br>
    ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ±ÙƒÙŠØ¨: ${row.start_date || row.start}<br>
    Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¶Ù…Ø§Ù†: <b>${row.expiry}</b>
  `;
}

</script>
</body>
</html>
