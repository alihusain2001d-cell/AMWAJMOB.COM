async function sendData(){

  // Ø±Ø§Ø¨Ø· Ø§Ù„Ø´ÙŠØª (CSV Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©)
  const SHEET =
"https://docs.google.com/spreadsheets/d/1BiV0ZxQN_ClD1tA7w8W5rfmY1bXfs9oax7Q3oqeXq38/export?format=csv";

  const data = {
    name: document.getElementById("name").value.trim(),
    phone: document.getElementById("phone").value.trim(),
    invoice: document.getElementById("invoice").value.trim(),
    type: document.getElementById("type").value,
    start: document.getElementById("start").value
  };

  // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
  if(!data.name || !data.phone || !data.invoice || !data.start){
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
    return;
  }

  // 1ï¸âƒ£ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ â€” Ø­ØªÙ‰ Ù†Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø©
  try{
    const res = await fetch(SHEET);
    const text = await res.text();

    const rows = text
      .trim()
      .split("\n")
      .map(r => r.split(","));

    const headers = rows.shift();   // Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
    const invoiceIndex = headers.indexOf("invoice");

    const exists = rows.find(r => r[invoiceIndex] == data.invoice);

    if(exists){
      alert("âš  Ù‡Ø°Ø§ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø³Ø¬Ù‘Ù„ Ø³Ø§Ø¨Ù‚Ø§Ù‹ â€” Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙƒØ±Ø§Ø±Ù‡");
      return;
    }
  }catch(e){
    alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙÙˆØ§ØªÙŠØ± â€” Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹");
    return;
  }

  // 2ï¸âƒ£ ØªØ­Ø¯ÙŠØ¯ Ù…Ø¯Ø© Ø§Ù„Ø¶Ù…Ø§Ù†
  let days = data.type === "screen" ? 30 : 365;

  const startDate = new Date(data.start);
  const expiry = new Date(startDate);
  expiry.setDate(expiry.getDate() + days);

  // Ù†Ø¶ÙŠÙÙ‡ Ù„Ù„Ø§Ø±Ø³Ø§Ù„
  data.expiry = expiry.toISOString().slice(0,10);

  // 3ï¸âƒ£ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø²Ø¨ÙˆÙ†
  const box = document.getElementById("result");
  box.style.display = "block";
  box.innerHTML = `
    â­ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­ â­<br><br>
    ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙØ¹ÙŠÙ„: <b>${data.start}</b><br>
    ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: <b>${data.expiry}</b>
    <div id="timer" class="timer-box"></div>
  `;

  // Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
  setInterval(()=>{
    const now = new Date();
    const diff = expiry - now;
    if(diff <= 0){
      document.getElementById("timer").innerHTML = "âš  Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¶Ù…Ø§Ù†";
      return;
    }
    const daysLeft = Math.floor(diff / (1000*60*60*24));
    document.getElementById("timer").innerHTML =
      `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <b>${daysLeft}</b> ÙŠÙˆÙ…`;
  },1000);

  // 4ï¸âƒ£ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Pipedream (Ø§Ù„Ø´ÙŠØª)
  fetch("https://eo9txe5hkh3d1yk.m.pipedream.net",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(data)
  }).catch(()=>alert("Ø­Ø¯Ø« Ø®Ø·Ø£ â€” Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"));

  // 5ï¸âƒ£ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø²Ø¨ÙˆÙ†
  const msg =
`Ø´ÙƒØ±Ø§Ù‹ Ù„Ø´Ø±Ø§Ø¦Ùƒ Ù…Ù† Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª ğŸŒŠ
ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¶Ù…Ø§Ù†Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ”

Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${data.invoice}
ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: ${data.expiry}

Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ø¶Ù…Ø§Ù†:
https://www.amwajmob.com/index.html`;

  window.open(`https://wa.me/964${data.phone.slice(-10)}?text=${encodeURIComponent(msg)}`);
}
