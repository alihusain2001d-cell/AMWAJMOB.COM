<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="icon" type="image/png" href="LOGO%20MOB.png">
<link rel="apple-touch-icon" href="LOGO%20MOB.png">
<meta name="apple-mobile-web-app-title" content="Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª">
<meta name="application-name" content="Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª">

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#17a2b8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0a4d68">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
}

#pricesPage * {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

#particles-bg {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #0a4d68 0%, #088395 50%, #05BFDB 100%);
  z-index: -1;
}

.particle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: rgba(255, 255, 255, 0.5);
  border-radius: 50%;
  animation: float 15s infinite ease-in-out;
}

@keyframes float {
  0%, 100% { transform: translateY(0) translateX(0); opacity: 0.3; }
  25% { transform: translateY(-30px) translateX(10px); opacity: 0.8; }
  50% { transform: translateY(-10px) translateX(-10px); opacity: 0.5; }
  75% { transform: translateY(-40px) translateX(5px); opacity: 0.7; }
}

.main-wrapper {
  padding: 18px;
  min-height: 100vh;
  position: relative;
  z-index: 1;
}

.container {
  max-width: 580px;
  margin: auto;
  background: rgba(255, 255, 255, 0.60);
  padding: 18px;
  border-radius: 16px;
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(8px);
}

.logo { text-align: center; margin-bottom: 12px; }
.logo img { width: 150px; }

.bigbtn {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: 0;
  margin: 8px 0;
  font-size: 20px;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}
.bigbtn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
.bigbtn:active { transform: translateY(0); }
.big1 { background: #1e88e5; color: #fff; }
.big2 { background: #6c7d90; color: #fff; }
.big3 { background: #25D366; color: #fff; }
.big4 { background: #f39c12; color: #fff; }

label { font-weight: bold; font-size: 14px; display: block; margin-top: 10px; }

input, select, button {
  width: 100%;
  padding: 10px;
  margin: 6px 0 10px;
  border-radius: 10px;
  border: 1px solid #ccd6e6;
  font-size: 16px;
  box-sizing: border-box;
}
button { background: #1e88e5; color: #fff; border: none; cursor: pointer; }
button:disabled { background: #ccc; cursor: not-allowed; }

.result { background: #e8f4ff; padding: 12px; border-radius: 10px; margin-top: 10px; }
.result.success { background: #e8f8e8; color: #1b5e20; }
.result.error { background: #fde7e7; color: #b10606; }
.result.pending { background: #fff3cd; color: #856404; }

.footer { text-align: center; margin-top: 12px; font-size: 16px; }

.whatsapp {
  background: #25D366; color: #fff; padding: 10px;
  display: block; text-align: center; border-radius: 10px;
  margin-top: 14px; text-decoration: none; transition: transform 0.2s;
}
.whatsapp:hover { transform: translateY(-2px); }

.brands-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 16px; }

.brand {
  cursor: pointer; background: #f5f7fa; border-radius: 12px;
  padding: 14px 8px; text-align: center; font-weight: bold;
  transition: all 0.2s ease; border: 1px solid #e0e0e0;
}
.brand:hover { background: #e9eef5; transform: scale(1.02); }
.brand:active { transform: scale(0.98); background: #dfe6ef; }
.brand small { display: block; font-weight: normal; opacity: 0.7; margin-top: 3px; font-size: 11px; }

.welcome-text { text-align: center; font-size: 18px; color: #1e3a5f; margin: 15px 0; line-height: 1.8; }
.section-title { text-align: center; color: #1e88e5; font-size: 22px; margin: 15px 0; }
.info-box { background: #f0f7ff; padding: 12px; border-radius: 10px; margin: 10px 0; text-align: center; }

#loadingPage {
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; min-height: 60vh; text-align: center;
}
#loadingPage img { width: 180px; margin-bottom: 20px; }

.loading-spinner {
  border: 4px solid #e0e0e0; border-top: 4px solid #1e88e5;
  border-radius: 50%; width: 40px; height: 40px;
  animation: spin 1s linear infinite; margin: 20px auto;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.loading-text { color: #1e88e5; font-size: 18px; margin-top: 10px; }

/* Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù„Ø© */
.cart-badge {
  position: fixed;
  top: 20px;
  left: 20px;
  background: #1e88e5;
  color: white;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  z-index: 1000;
  transition: transform 0.2s;
}
.cart-badge:hover { transform: scale(1.1); }
.cart-count {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #f44336;
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: bold;
}
.add-to-cart-btn {
  background: #25D366;
  color: white;
  padding: 8px 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  margin-top: 8px;
  width: 100%;
  font-weight: bold;
  transition: all 0.2s;
}
.add-to-cart-btn:hover { background: #1fa855; transform: translateY(-2px); }
.cart-item {
  background: #f5f7fa;
  padding: 12px;
  margin: 8px 0;
  border-radius: 10px;
}
.cart-item-info {
  width: 100%;
}

/* ==================== Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„ØªÙ‚Ø³ÙŠÙ…Ø§Øª ==================== */
#flatpowerModal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  z-index: 9000;
  align-items: flex-end;
  justify-content: center;
  backdrop-filter: blur(4px);
}
#flatpowerModal.active {
  display: flex;
}

.flatpower-sheet {
  background: white;
  border-radius: 24px 24px 0 0;
  padding: 20px 16px 30px;
  width: 100%;
  max-width: 580px;
  animation: slideUp 0.3s ease;
  max-height: 85vh;
  overflow-y: auto;
}

@keyframes slideUp {
  from { transform: translateY(100%); opacity: 0; }
  to   { transform: translateY(0);    opacity: 1; }
}

.flatpower-handle {
  width: 40px;
  height: 4px;
  background: #ddd;
  border-radius: 2px;
  margin: 0 auto 16px;
}

.flatpower-title {
  text-align: center;
  font-size: 18px;
  font-weight: bold;
  color: #1e3a5f;
  margin-bottom: 16px;
}

.flatpower-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}

.flatpower-btn {
  background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
  border: 2px solid #e0e8f0;
  border-radius: 16px;
  padding: 14px 10px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s ease;
  font-weight: bold;
  color: #1e3a5f;
}

.flatpower-btn:hover {
  background: linear-gradient(135deg, #1e88e5 0%, #0d6efd 100%);
  color: white;
  border-color: #1e88e5;
  transform: scale(1.03);
  box-shadow: 0 6px 20px rgba(30,136,229,0.35);
}

.flatpower-btn:active {
  transform: scale(0.97);
}

.flatpower-btn .btn-icon {
  font-size: 24px;
  display: block;
  margin-bottom: 6px;
}

.flatpower-btn .btn-label {
  font-size: 14px;
  font-weight: bold;
  display: block;
}

.flatpower-btn .btn-sub {
  font-size: 11px;
  opacity: 0.65;
  display: block;
  margin-top: 3px;
  font-weight: normal;
}

.flatpower-close {
  display: block;
  width: 100%;
  margin-top: 14px;
  padding: 12px;
  background: #f44336;
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
}

@media print { #pricesPage { display: none !important; } }
</style>
</head>
<body>

<script>
document.addEventListener('contextmenu', function(e) {
  if (document.getElementById('pricesPage') && document.getElementById('pricesPage').style.display !== 'none') { e.preventDefault(); return false; }
});
document.addEventListener('keydown', function(e) {
  if (document.getElementById('pricesPage') && document.getElementById('pricesPage').style.display !== 'none') {
    if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'a' || e.key === 'p')) { e.preventDefault(); return false; }
  }
});
</script>

<div id="particles-bg"></div>

<!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø³Ù„Ø© -->
<div id="cartBadge" class="cart-badge" onclick="openCart()">
  ğŸ›’
  <span id="cartCount" class="cart-count">0</span>
</div>

<!-- ==================== Ù…ÙˆØ¯ÙŠÙ„ ØªÙ‚Ø³ÙŠÙ…Ø§Øª Ø¨ÙˆØ± + ØµÙˆØª ==================== -->
<div id="flatpowerModal" onclick="closeFlatpowerModal(event)">
  <div class="flatpower-sheet" onclick="event.stopPropagation()">
    <div class="flatpower-handle"></div>
    <div class="flatpower-title">ğŸ”§ Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ù…Ù†ÙˆØ¹Ø©</div>
    <div class="flatpower-grid">
      <div class="flatpower-btn" onclick="openFlatSub('FLAT POWER', 'ÙÙ„Ø§Øª Ø¨ÙˆØ±', 'âš¡')">
        <span class="btn-icon">âš¡</span>
        <span class="btn-label">ÙÙ„Ø§Øª Ø¨ÙˆØ±</span>
        <span class="btn-sub">FLAT POWER</span>
      </div>
      <div class="flatpower-btn" onclick="openFlatSub('FLAT VOLUME', 'ÙÙ„Ø§Øª ØµÙˆØª', 'ğŸ”‰')">
        <span class="btn-icon">ğŸ”‰</span>
        <span class="btn-label">ÙÙ„Ø§Øª ØµÙˆØª</span>
        <span class="btn-sub">FLAT VOLUME</span>
      </div>
      <div class="flatpower-btn" onclick="openFlatSub('BUZZER', 'Ø³Ù…Ø§Ø¹Ø© Ø¬Ø±Ø³', 'ğŸ””')">
        <span class="btn-icon">ğŸ””</span>
        <span class="btn-label">Ø³Ù…Ø§Ø¹Ø© Ø¬Ø±Ø³</span>
        <span class="btn-sub">BUZZER</span>
      </div>
      <div class="flatpower-btn" onclick="openFlatSub('EAR SPEAKER', 'Ø³Ù…Ø§Ø¹Ø© Ø§ØªØµØ§Ù„', 'ğŸ“')">
        <span class="btn-icon">ğŸ“</span>
        <span class="btn-label">Ø³Ù…Ø§Ø¹Ø© Ø§ØªØµØ§Ù„</span>
        <span class="btn-sub">EAR SPEAKER</span>
      </div>
      <div class="flatpower-btn" onclick="openFlatSub('DOOR SIM', 'Ø¨Ø§Ø¨ Ø³ÙŠÙ… ÙƒØ§Ø±Øª', 'ğŸ’³')">
        <span class="btn-icon">ğŸ’³</span>
        <span class="btn-label">Ø¨Ø§Ø¨ Ø³ÙŠÙ… ÙƒØ§Ø±Øª</span>
        <span class="btn-sub">DOOR SIM</span>
      </div>
      <div class="flatpower-btn" onclick="openFlatSub('FINGERPRINT', 'Ø¨ØµÙ…Ø©', 'ğŸ‘†')">
        <span class="btn-icon">ğŸ‘†</span>
        <span class="btn-label">Ø¨ØµÙ…Ø©</span>
        <span class="btn-sub">FINGERPRINT</span>
      </div>
      <div class="flatpower-btn" onclick="openFlatSub('OTHER', 'Ù…Ù†ÙˆØ¹Ø©', 'ğŸ“¦')">
        <span class="btn-icon">ğŸ“¦</span>
        <span class="btn-label">Ù…Ù†ÙˆØ¹Ø©</span>
        <span class="btn-sub">OTHER</span>
      </div>
      <div class="flatpower-btn" onclick="openLensFromModal()">
        <span class="btn-icon">ğŸ“·</span>
        <span class="btn-label">Ø¹Ø¯Ø³Ø© ÙƒØ§Ù…ÙŠØ±Ø§</span>
        <span class="btn-sub">LENS CAMERA</span>
      </div>
    </div>
    <button class="flatpower-close" onclick="closeFlatpowerModal()">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<div class="main-wrapper">
  <div class="container">
    <div class="logo">
      <img src="1646237145252.png" alt="Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª">
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loadingPage">
      <div class="loading-spinner"></div>
      <div class="loading-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
    <div id="registerPage" style="display:none">
      <h2 class="section-title">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
      <p class="welcome-text">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª<br>Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¶Ù…Ø§Ù†</p>
      <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
      <input type="text" id="regName" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ">
      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„</label>
      <input type="text" id="regShop" placeholder="Ø§Ø³Ù… Ù…Ø­Ù„Ùƒ Ø£Ùˆ Ø´Ø±ÙƒØªÙƒ">
      <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
      <input type="tel" id="regPhone" placeholder="07xxxxxxxxx">
      <button class="bigbtn big1" id="btnRegister" onclick="submitRegistration()">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
      <div id="regResult"></div>
      <div style="text-align:center;margin-top:20px;padding-top:15px;border-top:1px solid #eee;">
        <p style="color:#666;">Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŸ</p>
        <button class="bigbtn big2" onclick="showLoginPage()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      </div>
      <div class="info-box">
        ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±:<br>
        <div style="margin-top:5px;">
          <a href="tel:7696" style="font-weight:bold;color:#1e88e5;display:block;margin:3px 0;">ğŸ“± 7696</a>
          <a href="tel:07709000160" style="font-weight:bold;color:#1e88e5;display:block;margin:3px 0;">ğŸ“± 07709000160</a>
        </div>
      </div>
    </div>

    <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginPage" style="display:none">
      <h2 class="section-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <p class="welcome-text">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹<br>ğŸŒŠ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ù„Ù„Ø¯Ø®ÙˆÙ„</p>
      <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
      <input type="tel" id="loginPhone" placeholder="07xxxxxxxxx">
      <button class="bigbtn big1" id="btnLogin" onclick="checkLogin()">Ø¯Ø®ÙˆÙ„</button>
      <div id="loginResult"></div>
      <div style="text-align:center;margin-top:20px;padding-top:15px;border-top:1px solid #eee;">
        <p style="color:#666;">Ù…Ø§ Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ØŸ</p>
        <button class="bigbtn big3" onclick="showRegisterPage()">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
      </div>
    </div>

    <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="homePage" style="display:none">
      <div id="welcomeUser" class="info-box" style="font-size:18px;font-weight:bold;"></div>
      
      <!-- Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø¶Ù…Ø§Ù† -->
      <div class="brands-grid" style="margin-bottom:20px;">
        <div class="brand" onclick="openAct()" style="cursor:pointer;">
          <div style="font-size:20px;margin-bottom:6px;">âœ…</div>
          <div style="font-weight:bold;font-size:14px;">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</div>
          <small style="color:#666;">Activate Warranty</small>
        </div>
        <div class="brand" onclick="openChk()" style="cursor:pointer;">
          <div style="font-size:20px;margin-bottom:6px;">ğŸ”</div>
          <div style="font-weight:bold;font-size:14px;">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¶Ù…Ø§Ù†</div>
          <small style="color:#666;">Check Warranty</small>
        </div>
      </div>
      
      <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø§Ù… -->
      <div style="background:#fff;padding:16px;border-radius:12px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.1);">
        <div style="display:flex;align-items:center;gap:10px;">
          <span style="font-size:24px;">ğŸ”</span>
          <input type="text" id="globalSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬... (Ù…Ø«Ø§Ù„: A10)" 
                 style="flex:1;padding:12px;border:2px solid #e0e8f0;border-radius:10px;font-size:16px;margin:0;"
                 onkeyup="handleGlobalSearch(event)">
        </div>
        <div id="globalSearchResults" style="margin-top:12px;display:none;"></div>
      </div>
      
      <!-- Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
      <div class="brands-grid">
        <div class="brand" onclick="openPrices('screens')" style="cursor:pointer;">
          <div style="font-size:24px;margin-bottom:6px;">ğŸ–¥ï¸</div>
          <div style="font-weight:bold;font-size:14px;">Ø§Ù„Ø´Ø§Ø´Ø§Øª</div>
          <small style="color:#666;">Screens</small>
        </div>
        <div class="brand" onclick="openPrices('batteries')" style="cursor:pointer;">
          <div style="font-size:24px;margin-bottom:6px;">ğŸ”‹</div>
          <div style="font-weight:bold;font-size:14px;">Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ§Øª</div>
          <small style="color:#666;">Batteries</small>
        </div>
        <div class="brand" onclick="openPrices('chargeboards')" style="cursor:pointer;">
          <div style="font-size:24px;margin-bottom:6px;">ğŸ”Œ</div>
          <div style="font-weight:bold;font-size:14px;">Ø¨ÙˆØ±Ø¯ Ø´Ø­Ù†</div>
          <small style="color:#666;">Charge Board</small>
        </div>
        <div class="brand" onclick="openPrices('flatcharging')" style="cursor:pointer;">
          <div style="font-size:24px;margin-bottom:6px;">âš¡</div>
          <div style="font-weight:bold;font-size:14px;">Ø´Ø±ÙŠØ· Ø´Ø­Ù† + Ø´Ø§Ø´Ø©</div>
          <small style="color:#666;">Charging Flex</small>
        </div>
        <!-- Ø²Ø± Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ù…Ù†ÙˆØ¹Ø© - ÙŠÙØªØ­ Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„ØªÙ‚Ø³ÙŠÙ…Ø§Øª -->
        <div class="brand" onclick="openFlatpowerModal()" style="cursor:pointer;">
          <div style="font-size:24px;margin-bottom:6px;">ğŸ”Š</div>
          <div style="font-weight:bold;font-size:14px;">Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ù…Ù†ÙˆØ¹Ø©</div>
          <small style="color:#666;">Power & Sound & Misc</small>
        </div>
        <div class="brand" onclick="openPrices('backcover')" style="cursor:pointer;">
          <div style="font-size:24px;margin-bottom:6px;">ğŸ“±</div>
          <div style="font-weight:bold;font-size:14px;">Ø¨Ø§Ùƒ ÙƒÙØ±</div>
          <small style="color:#666;">Back Cover</small>
        </div>
        <div class="brand" onclick="openPrices('housing')" style="cursor:pointer;">
          <div style="font-size:24px;margin-bottom:6px;">ğŸ </div>
          <div style="font-weight:bold;font-size:14px;">Ø´Ø§ØµÙŠ</div>
          <small style="color:#666;">Housing</small>
        </div>
        <div class="brand" onclick="openPrices('camera')" style="cursor:pointer;">
          <div style="font-size:24px;margin-bottom:6px;">ğŸ“·</div>
          <div style="font-weight:bold;font-size:14px;">ÙƒØ§Ù…ÙŠØ±Ø§</div>
          <small style="color:#666;">Camera</small>
        </div>
      </div>
      
      <!-- Ø¨Ø­Ø« Google (Ù†ØµÙŠ + ØµÙˆØ±Ø©) -->
      <div style="background:linear-gradient(135deg, #4285f4 0%, #34a853 100%);padding:16px;border-radius:12px;margin-top:20px;box-shadow:0 4px 12px rgba(66,133,244,0.3);">
        <div style="color:white;font-weight:bold;font-size:16px;margin-bottom:12px;text-align:center;">
          ğŸŒ Ø¨Ø­Ø« Google
        </div>
        
        <!-- Ø¨Ø­Ø« Ù†ØµÙŠ -->
        <div style="display:flex;gap:8px;margin-bottom:12px;">
          <input type="text" id="googleTextSearch" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Google (Ù…Ø«Ø§Ù„: Samsung A10 screen)" 
                 style="flex:1;padding:12px;border:none;border-radius:10px;font-size:15px;"
                 onkeypress="if(event.key==='Enter') searchGoogle()">
          <button onclick="searchGoogle()" 
                  style="background:#fff;color:#4285f4;padding:12px 20px;border:none;border-radius:10px;font-weight:bold;cursor:pointer;width:auto;margin:0;">
            Ø¨Ø­Ø«
          </button>
        </div>
        
        <!-- Ø¨Ø­Ø« Ø¨Ø§Ù„ØµÙˆØ±Ø© -->
        <div style="background:rgba(255,255,255,0.2);padding:12px;border-radius:10px;text-align:center;">
          <input type="file" id="googleImageInput" accept="image/*" style="display:none;" onchange="searchGoogleByImage(this)">
          <button onclick="document.getElementById('googleImageInput').click()" 
                  style="background:#fff;color:#34a853;padding:12px 20px;border:none;border-radius:10px;font-weight:bold;cursor:pointer;width:100%;margin:0;">
            ğŸ“· Ø¨Ø­Ø« Ø¨Ø§Ù„ØµÙˆØ±Ø© (Google Lens)
          </button>
          <div id="imageSearchStatus" style="color:#fff;font-size:13px;margin-top:8px;"></div>
        </div>
      </div>
      
      <div class="info-box" style="margin-top:20px;">
        ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±:<br>
        <div style="margin-top:5px;">
          <a href="tel:7696" style="font-weight:bold;color:#1e88e5;display:block;margin:3px 0;">ğŸ“± 7696</a>
          <a href="tel:07709000160" style="font-weight:bold;color:#1e88e5;display:block;margin:3px 0;">ğŸ“± 07709000160</a>
        </div>
        <div style="margin-top:8px;color:#555;">Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª ÙŠØ±Ø­Ø¨ Ø¨ÙƒÙ… ğŸŒŠ</div>
      </div>
      <a href="https://wa.me/9647709000160" target="_blank" class="whatsapp">ğŸŸ¢ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</a>
      <button class="bigbtn" style="background:#f44336;margin-top:15px;" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ -->
    <div id="activatePage" style="display:none">
      <button onclick="backHome()" class="bigbtn big2">â¬… Ø±Ø¬ÙˆØ¹</button>
      <h3 class="section-title">ØªÙØ¹ÙŠÙ„ Ø¶Ù…Ø§Ù† Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</h3>
      <label>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</label>
      <input id="name">
      <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
      <input id="phone">
      <label>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
      <input id="invoice">
      <label>ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©</label>
      <input id="screenCode" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø®Ù„Ù Ø§Ù„Ø´Ø§Ø´Ø©">
      <label>Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø´Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <input id="screenName" placeholder="Ù…Ø«Ø§Ù„: iPhone 11 Pro">
      <label>Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
      <select id="type">
        <option value="screen">Ø´Ø§Ø´Ø©</option>
        <option value="battery">Ø¨Ø·Ø§Ø±ÙŠØ©</option>
      </select>
      <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ±ÙƒÙŠØ¨</label>
      <input id="start" readonly>
      <div id="dupMsg" style="display:none;background:#fde7e7;color:#b10606;padding:10px;border-radius:10px;margin:10px 0;"></div>
      <button id="btnActivate" class="bigbtn big1" onclick="sendData()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</button>
      <div id="result"></div>
      <div class="footer">
        ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: <a href="tel:7696" style="font-weight:bold;color:#1e88e5;">7696</a><br>
        Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø±ÙƒÙ… Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª ğŸŒŠ
        <a class="whatsapp" href="https://wa.me/9647709000160" target="_blank">ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</a>
      </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„ØªØ­Ù‚Ù‚ -->
    <div id="checkPage" style="display:none">
      <button onclick="backHome()" class="bigbtn big2">â¬… Ø±Ø¬ÙˆØ¹</button>
      <h3 class="section-title">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¶Ù…Ø§Ù†</h3>
      <input id="inv" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©">
      <button class="bigbtn big1" onclick="checkWarranty()">Ø¨Ø­Ø«</button>
      <div id="out"></div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
    <div id="pricesPage" style="display:none">
      <h3 class="section-title" id="pricesTitle">ğŸ”’ Ø§Ù„Ø´Ø§Ø´Ø§Øª</h3>
      <input type="text" id="searchInput" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„..." style="width:100%;margin:10px 0;padding:12px;">
      <div id="brandsSection">
        <div class="brands-grid" id="brandsGrid">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
      </div>
      <div id="brandPrices" style="display:none">
        <div id="brandPricesBox"></div>
      </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø© -->
    <div id="cartPage" style="display:none">
      <h3 class="section-title">ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
      
      <div id="cartItems"></div>
      
      <div id="cartSummary" style="background:#f0f7ff;padding:12px;border-radius:10px;margin:15px 0;display:none;">
        <div style="display:flex;justify-content:space-between;font-size:18px;font-weight:bold;">
          <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
          <span id="cartTotal">0 Ø¯.Ø¹</span>
        </div>
      </div>
      
      <button onclick="clearCart()" class="bigbtn" style="background:#f44336;display:none;" id="clearCartBtn">ğŸ—‘ï¸ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</button>
      
      <div id="orderForm" style="margin-top:20px;display:none;">
        <h4 style="text-align:center;color:#1e88e5;margin:15px 0;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h4>
        
        <label>Ø§Ù„Ø§Ø³Ù…</label>
        <input type="text" id="orderName" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„">
        
        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„</label>
        <input type="text" id="orderShop" placeholder="Ø§Ø³Ù… Ù…Ø­Ù„Ùƒ">
        
        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
        <input type="text" id="orderAddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„">
        
        <button onclick="submitOrder()" class="bigbtn big3">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
        <div id="orderResult"></div>
      </div>
    </div>

  </div>
  
  <!-- Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø§Ù„Ø¹Ø§Ø¦Ù… -->
  <button id="backToTopBtn" onclick="backToBrands()" style="
    display: none;
    position: fixed;
    top: 80px;
    right: 20px;
    z-index: 9999;
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    color: white;
    border: none;
    border-radius: 50px;
    width: 60px;
    height: 60px;
    font-size: 24px;
    box-shadow: 0 4px 15px rgba(23, 162, 184, 0.4);
    cursor: pointer;
    transition: all 0.3s ease;
  ">
    â¡ï¸
  </button>

</div>

<script>
// ==================== Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© ====================
function createParticles() {
  const bg = document.getElementById('particles-bg');
  for (let i = 0; i < 50; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.left = Math.random() * 100 + '%';
    particle.style.top = Math.random() * 100 + '%';
    particle.style.animationDelay = Math.random() * 15 + 's';
    particle.style.animationDuration = (10 + Math.random() * 10) + 's';
    const size = 2 + Math.random() * 4;
    particle.style.width = size + 'px';
    particle.style.height = size + 'px';
    bg.appendChild(particle);
  }
}
createParticles();

// ==================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ====================
const CONFIG = {
  API_URL: "https://script.google.com/macros/s/AKfycbwHckW5szEk1Bi5s4BndOPUeO5vwd2ilMXxjYjv7WxJUeWH09H19vzl1oyUo2zf0SXDUQ/exec",
  API_KEY: "AMWAJ_d5fb3e7a-6534-4afa-8c52-b3d14b2d6d22",
  DEVICE_ID: generateDeviceId()
};

function generateDeviceId() {
  let deviceId = localStorage.getItem('amwaj_device_id');
  if (!deviceId) {
    deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substring(7);
    localStorage.setItem('amwaj_device_id', deviceId);
  }
  return deviceId;
}

async function secureApiCall(action, data = {}) {
  try {
    const response = await fetch(CONFIG.API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify({ apiKey: CONFIG.API_KEY, action: action, identifier: CONFIG.DEVICE_ID, ...data })
    });
    const result = await response.json();
    if (!result.success) throw new Error(result.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£');
    return result.data;
  } catch (error) {
    console.error('API Error:', error);
    throw error;
  }
}

// ==================== ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ====================
function normalizeNumber(str) {
  if (!str && str !== 0) return "";
  str = String(str);
  return str.replace(/[Ù -Ù©]/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©".indexOf(d)).replace(/[Û°-Û¹]/g, d => "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(d)).replace(/\s/g, "");
}

function normalizePhone(phone) {
  let p = normalizeNumber(phone).replace(/[^0-9]/g, "");
  if (p.startsWith("964")) p = "0" + p.slice(3);
  if (p.startsWith("+964")) p = "0" + p.slice(4);
  if (p.length === 10 && !p.startsWith("0")) p = "0" + p;
  return p;
}

// ==================== Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø§Ø±ÙƒØ© ====================
function extractBrand(name) {
  const nameUpper = (name || '').toUpperCase();
  
  const brands = {
    'GOOGLE': 'Google',
    'HUAWEI': 'Huawei', 
    'HONOR': 'Honor',
    'SAMSUNG': 'Samsung',
    'SAM': 'Samsung',
    'XIAOMI': 'Xiaomi',
    'REDMI': 'Redmi',
    'POCO': 'Poco',
    'REALME': 'Realme',
    'INFINIX': 'Infinix',
    'TECNO': 'Tecno',
    'OPPO': 'Oppo',
    'VIVO': 'Vivo',
    'ASUS': 'Asus',
    'IPHONE': 'Apple',
    'IPAD': 'Apple',
    'APPLE': 'Apple',
    'NOKIA': 'Nokia',
    'ONEPLUS': 'OnePlus',
    'NOTHING': 'Nothing',
    'SONY': 'Sony',
    'LG': 'LG',
    'MOTOROLA': 'Motorola',
    'LENOVO': 'Lenovo',
    'ZTE': 'ZTE',
    'ALCATEL': 'Alcatel',
    'TCL': 'TCL',
    'BLACKVIEW': 'Blackview',
    'WIKO': 'Wiko'
  };
  
  let foundBrand = 'Ø£Ø®Ø±Ù‰';
  let maxLength = 0;
  
  for (let key in brands) {
    if (nameUpper.includes(key) && key.length > maxLength) {
      foundBrand = brands[key];
      maxLength = key.length;
    }
  }
  
  return foundBrand;
}

// ==================== Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„ÙÙ„Ø§Øª Ø¨ÙˆØ± ==================== 
function openFlatpowerModal() {
  const modal = document.getElementById('flatpowerModal');
  modal.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeFlatpowerModal(event) {
  // Ø¥Ø°Ø§ Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ© (Ù…Ø´ Ø§Ù„Ø´ÙŠØª Ù†ÙØ³Ù‡) Ø£Ùˆ Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
  if (!event || event.target === document.getElementById('flatpowerModal')) {
    const modal = document.getElementById('flatpowerModal');
    modal.classList.remove('active');
    document.body.style.overflow = '';
  }
}

function openLensFromModal() {
  document.getElementById('flatpowerModal').classList.remove('active');
  document.body.style.overflow = '';
  openPrices('lens');
}

// Ø®Ø±ÙŠØ·Ø© ÙƒÙ„ Ù‚Ø³Ù… â†’ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ù„Ø©
function getFlatSubData(subType) {
  switch(subType) {
    case 'FLAT POWER':   return flatpowerData.filter(i => i.name.toUpperCase().includes('FLAT POWER'));
    case 'FLAT VOLUME':  return flatpowerData.filter(i => i.name.toUpperCase().includes('FLAT VOLUME'));
    case 'BUZZER':       return buzzerData;
    case 'EAR SPEAKER':  return earSpeakerData;
    case 'DOOR SIM':     return doorSimData;
    case 'FINGERPRINT':  return fingerprintData;
    case 'CAMERA':       return cameraData;
    case 'OTHER':        return miscData;
    default: return [];
  }
}

function openFlatSub(subType, labelAr, icon) {
  document.getElementById('flatpowerModal').classList.remove('active');
  document.body.style.overflow = '';

  currentPriceType = 'flatpower';
  currentFlatSubType = subType;

  showPage("pricesPage");
  showBackButton();

  document.getElementById("pricesTitle").innerHTML = `${icon} ${labelAr}`;
  document.getElementById("brandsSection").style.display = "block";
  document.getElementById("brandPrices").style.display = "none";

  renderBrandsGrid('flatpower');

  const searchInput = document.getElementById("searchInput");
  searchInput.value = "";
  searchInput.oninput = function() {
    const q = this.value.trim().toLowerCase();
    if (q.length < 2) { 
      document.getElementById("brandsSection").style.display = "block"; 
      document.getElementById("brandPrices").style.display = "none"; 
      return; 
    }
    document.getElementById("brandsSection").style.display = "none";
    document.getElementById("brandPrices").style.display = "block";
    const box = document.getElementById("brandPricesBox");
    box.innerHTML = `<div style="text-align:center;padding:40px 20px;"><div class="loading-spinner"></div></div>`;

    setTimeout(() => {
      const data = getFlatSubData(subType);
      const filtered = data.filter(p =>
        (p.name && p.name.toLowerCase().includes(q)) ||
        (p.brand && p.brand.toLowerCase().includes(q))
      );
      box.innerHTML = `<h3 style="color:#1e88e5;margin:10px 0;">Ù†ØªØ§Ø¦Ø¬: "${q}" - ${labelAr}</h3>`;
      if (filtered.length === 0) { box.innerHTML += "<div style='padding:10px;color:#666;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>"; return; }
      filtered.slice(0, 50).forEach(p => { box.innerHTML += createPriceItem(p); });
      if (filtered.length > 50) box.innerHTML += `<div style="padding:10px;color:#666;text-align:center;">... Ùˆ ${filtered.length - 50} Ù†ØªÙŠØ¬Ø© Ø£Ø®Ø±Ù‰</div>`;
    }, 300);
  };
}

// Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
let currentFlatSubType = null;

// ==================== Ø§Ù„ØªÙ†Ù‚Ù„ ====================
function showPage(pageId) {
  ["loadingPage","registerPage","loginPage","homePage","activatePage","checkPage","pricesPage","cartPage"].forEach(p => {
    const el = document.getElementById(p);
    if (el) el.style.display = "none";
  });
  const target = document.getElementById(pageId);
  if (target) target.style.display = pageId === "loadingPage" ? "flex" : "block";
}

function showRegisterPage() { showPage("registerPage"); }
function showLoginPage() { showPage("loginPage"); }
function backHome() { showPage("homePage"); }
function openAct() { showPage("activatePage"); document.getElementById("start").value = formatDate(new Date()); }
function openChk() { showPage("checkPage"); }

let currentPriceType = 'screens';

function openPrices(type) {
  currentPriceType = type;
  currentFlatSubType = null;
  showPage("pricesPage");
  
  showBackButton();
  
  const title = document.getElementById("pricesTitle");
  if (type === 'batteries') {
    title.innerHTML = "ğŸ”‹ Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ§Øª";
  } else if (type === 'chargeboards') {
    title.innerHTML = "ğŸ”Œ Ø¨ÙˆØ±Ø¯ Ø´Ø­Ù†";
  } else if (type === 'flatcharging') {
    title.innerHTML = "âš¡ Ø´Ø±ÙŠØ· Ø´Ø­Ù† + Ø´Ø§Ø´Ø©";
  } else if (type === 'backcover') {
    title.innerHTML = "ğŸ“± Ø¨Ø§Ùƒ ÙƒÙØ±";
  } else if (type === 'housing') {
    title.innerHTML = "ğŸ  Ø´Ø§ØµÙŠ";
  } else if (type === 'lens') {
    title.innerHTML = "ğŸ“· Ø¹Ø¯Ø³Ø© ÙƒØ§Ù…ÙŠØ±Ø§";
  } else if (type === 'camera') {
    title.innerHTML = "ğŸ“¸ ÙƒØ§Ù…ÙŠØ±Ø§";
  } else {
    title.innerHTML = "ğŸ–¥ï¸ Ø§Ù„Ø´Ø§Ø´Ø§Øª";
  }
  
  document.getElementById("brandsSection").style.display = "block";
  document.getElementById("brandPrices").style.display = "none";
  
  renderBrandsGrid(type);
  
  const searchInput = document.getElementById("searchInput");
  searchInput.value = "";
  searchInput.oninput = function() {
    const q = this.value.trim().toLowerCase();
    if (q.length < 2) { 
      document.getElementById("brandsSection").style.display = "block"; 
      document.getElementById("brandPrices").style.display = "none"; 
      return; 
    }
    document.getElementById("brandsSection").style.display = "none";
    document.getElementById("brandPrices").style.display = "block";
    const box = document.getElementById("brandPricesBox");
    
    box.innerHTML = `<div style="text-align:center;padding:40px 20px;"><div class="loading-spinner"></div><div style="color:#1e88e5;font-size:16px;margin-top:15px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</div></div>`;
    
    setTimeout(() => {
      const dataToSearch = getDataForType(type);
      
      if (dataToSearch.length === 0) {
        box.innerHTML = `<div style="text-align:center;padding:40px 20px;color:#666;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±...</div>`;
        return;
      }
      
      box.innerHTML = `<h3 style="color:#1e88e5;margin:10px 0;">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«: "${q}"</h3>`;
      const filtered = dataToSearch.filter(p => (p.name && p.name.toLowerCase().includes(q)) || (p.brand && p.brand.toLowerCase().includes(q)));
      if (filtered.length === 0) { box.innerHTML += "<div style='padding:10px;color:#666;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>"; return; }
      filtered.slice(0, 50).forEach(p => { box.innerHTML += createPriceItem(p); });
      if (filtered.length > 50) box.innerHTML += `<div style="padding:10px;color:#666;text-align:center;">... Ùˆ ${filtered.length - 50} Ù†ØªÙŠØ¬Ø© Ø£Ø®Ø±Ù‰</div>`;
    }, 300);
  };
}

function getDataForType(type) {
  switch(type) {
    case 'batteries':    return batteriesData;
    case 'chargeboards': return chargeboardsData;
    case 'flatcharging': return flatchargingData;
    case 'flatpower':    return flatpowerData;
    case 'backcover':    return backcoverData;
    case 'housing':      return housingData;
    case 'lens':         return lensData;
    case 'camera':       return cameraData;
    default:             return pricesData;
  }
}

function renderBrandsGrid(type) {
  const grid = document.getElementById("brandsGrid");
  
  const commonBrands = `
    <div class="brand" data-brand="Huawei,Honor" onclick="openBrand(this)">Ù‡ÙˆØ§ÙˆÙŠ + Ù‡ÙˆÙ†Ø±<small>Huawei â€¢ Honor</small></div>
    <div class="brand" data-brand="Samsung" onclick="openBrand(this)">Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬<small>Samsung</small></div>
    <div class="brand" data-brand="Apple" onclick="openBrand(this)">Ø§ÙŠÙÙˆÙ†<small>Apple</small></div>
    <div class="brand" data-brand="Xiaomi,Redmi,Poco" onclick="openBrand(this)">Ø´Ø§ÙˆÙ…ÙŠ + Ø±ÙŠØ¯Ù…ÙŠ + Ø¨ÙˆÙƒÙˆ<small>Xiaomi â€¢ Redmi â€¢ Poco</small></div>
    <div class="brand" data-brand="Oppo,Realme" onclick="openBrand(this)">Ø§ÙˆØ¨Ùˆ + Ø±ÙŠÙ„Ù…ÙŠ<small>Oppo â€¢ Realme</small></div>
    <div class="brand" data-brand="Infinix,Tecno" onclick="openBrand(this)">Ø§Ù†ÙÙ†ÙƒØ³ + ØªÙƒÙ†Ùˆ<small>Infinix â€¢ Tecno</small></div>
    <div class="brand" data-brand="Vivo" onclick="openBrand(this)">ÙÙŠÙÙˆ<small>Vivo</small></div>
  `;
  
  if (type === 'screens') {
    grid.innerHTML = `
      <div class="brand" data-brand="Apple" onclick="openBrand(this)">Ø§ÙŠÙÙˆÙ†<small>iPhone</small></div>
      <div class="brand" data-brand="Samsung" onclick="openBrand(this)">Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬<small>Samsung</small></div>
      <div class="brand" data-brand="Huawei" onclick="openBrand(this)">Ù‡ÙˆØ§ÙˆÙŠ<small>Huawei</small></div>
      <div class="brand" data-brand="Xiaomi" onclick="openBrand(this)">Ø´Ø§ÙˆÙ…ÙŠ<small>Xiaomi</small></div>
      <div class="brand" data-brand="Redmi,Poco" onclick="openBrand(this)">Ø±ÙŠØ¯Ù…ÙŠ + Ø¨ÙˆÙƒÙˆ<small>Redmi & Poco</small></div>
      <div class="brand" data-brand="Infinix,Tecno" onclick="openBrand(this)">Ø§Ù†ÙÙ†ÙƒØ³ + ØªÙƒÙ†Ùˆ<small>Infinix & Tecno</small></div>
      <div class="brand" data-brand="Oppo,Realme" onclick="openBrand(this)">Ø§ÙˆØ¨Ùˆ + Ø±ÙŠÙ„Ù…ÙŠ<small>Oppo & Realme</small></div>
      <div class="brand" data-brand="Vivo,Wiko" onclick="openBrand(this)">ÙÙŠÙÙˆ + ÙˆÙŠÙƒÙˆ<small>Vivo & Wiko</small></div>
      <div class="brand" data-brand="Asus,RedMagic,Google" onclick="openBrand(this)">Ø§Ø²ÙˆØ² + Ø±ÙŠØ¯ Ù…Ø§Ø¬Ùƒ + ÙƒÙˆÙƒÙ„<small>Asus â€¢ RedMagic â€¢ Google</small></div>
      <div class="brand" data-brand="ZTE,Alcatel,TCL,Blackview" onclick="openBrand(this)">ZTE + Alcatel + TCL<small>ZTE â€¢ Alcatel â€¢ TCL â€¢ Blackview</small></div>
    `;
  } else if (type === 'chargeboards') {
    grid.innerHTML = commonBrands + `<div class="brand" data-brand="Asus,Google,Blackview" onclick="openBrand(this)">Ø§Ø²ÙˆØ² + ÙƒÙˆÙƒÙ„ + Ø¨Ù„Ø§Ùƒ ÙÙŠÙˆ<small>Asus â€¢ Google â€¢ Blackview</small></div>`;
  } else if (type === 'camera') {
    grid.innerHTML = commonBrands + `<div class="brand" data-brand="Asus,Google,Blackview" onclick="openBrand(this)">Ø§Ø²ÙˆØ² + ÙƒÙˆÙƒÙ„<small>Asus â€¢ Google â€¢ Blackview</small></div>`;
  } else {
    grid.innerHTML = commonBrands + `<div class="brand" data-brand="Asus,Google" onclick="openBrand(this)">Ø§Ø²ÙˆØ² + ÙƒÙˆÙƒÙ„<small>Asus â€¢ Google</small></div>`;
  }
}

// ==================== ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ ====================
async function submitRegistration() {
  const btn = document.getElementById("btnRegister");
  const result = document.getElementById("regResult");
  const name = document.getElementById("regName").value.trim();
  const shop = document.getElementById("regShop").value.trim();
  const phone = normalizePhone(document.getElementById("regPhone").value);

  if (!name || !shop || !phone) { result.innerHTML = '<div class="result error">âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„</div>'; return; }
  if (phone.length < 11) { result.innerHTML = '<div class="result error">âŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­</div>'; return; }

  btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
  try {
    const rows = await fetchCustomers();
    const existing = rows.find(r => normalizePhone(r.phone) === phone);
    if (existing) {
      if (existing.status === "approved") { localStorage.setItem("amwaj_phone", phone); result.innerHTML = '<div class="result success">âœ… Ø±Ù‚Ù…Ùƒ Ù…Ø³Ø¬Ù„ ÙˆÙ…ÙØ¹Ù„! ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>'; }
      else if (existing.status === "pending") { localStorage.setItem("amwaj_phone", phone); result.innerHTML = '<div class="result pending">â³ Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</div>'; }
      else { result.innerHTML = '<div class="result error">âŒ ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨Ùƒ Ø³Ø§Ø¨Ù‚Ø§Ù‹ØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„Ù„Ù…Ø²ÙŠØ¯</div>'; }
      btn.disabled = false; btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„"; return;
    }
    await secureApiCall('addCustomer', { name, shop, phone, date: formatDate(new Date()), status: 'pending' });
    localStorage.setItem("amwaj_phone", phone);
    result.innerHTML = `<div class="result success">âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!<br>Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ ÙˆØ§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹<br>ğŸ“± Ø±Ù‚Ù…Ùƒ: <b>${phone}</b></div>`;
    document.getElementById("regName").value = ""; document.getElementById("regShop").value = ""; document.getElementById("regPhone").value = "";
  } catch (e) { console.error(e); result.innerHTML = '<div class="result error">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>'; }
  btn.disabled = false; btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
}

// ==================== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ====================
async function checkLogin() {
  const result = document.getElementById("loginResult");
  const phone = normalizePhone(document.getElementById("loginPhone").value);
  if (!phone || phone.length < 11) { result.innerHTML = '<div class="result error">âŒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­</div>'; return; }
  showPage("loadingPage");
  const timeoutId = setTimeout(() => { showPage("loginPage"); result.innerHTML = '<div class="result error">âŒ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‡Ù„Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>'; }, 10000);
  try {
    const rows = await fetchCustomers(); clearTimeout(timeoutId);
    const user = rows.find(r => normalizePhone(r.phone) === phone);
    if (!user) { showPage("loginPage"); result.innerHTML = '<div class="result error">âŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± Ù…Ø³Ø¬Ù„<br>Ø³Ø¬Ù„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ø£ÙˆÙ„Ø§Ù‹</div>'; }
    else if (user.status === "approved") { localStorage.setItem("amwaj_user", JSON.stringify(user)); localStorage.setItem("amwaj_phone", phone); document.getElementById("welcomeUser").innerHTML = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name} ğŸ‘‹<br><small>${user.shop}</small>`; showPage("homePage"); result.innerHTML = ""; }
    else if (user.status === "pending") { localStorage.setItem("amwaj_phone", phone); showPage("loginPage"); result.innerHTML = '<div class="result pending">â³ Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©<br>Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆØ­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹</div>'; }
    else { showPage("loginPage"); result.innerHTML = '<div class="result error">âŒ ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨Ùƒ<br>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</div>'; }
  } catch (e) { clearTimeout(timeoutId); console.error(e); showPage("loginPage"); result.innerHTML = '<div class="result error">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>'; }
}

function logout() { 
  localStorage.removeItem("amwaj_user"); 
  localStorage.removeItem("amwaj_phone"); 
  document.getElementById("loginPhone").value = ""; 
  document.getElementById("loginResult").innerHTML = ""; 
  cart = [];
  saveCart();
  showPage("loginPage"); 
}
async function fetchCustomers() { return await secureApiCall('getCustomers'); }

// ==================== Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø§Ù… ÙÙŠ ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ====================
function handleGlobalSearch(event) {
  const query = event.target.value.trim().toLowerCase();
  const resultsDiv = document.getElementById('globalSearchResults');
  
  if (query.length < 2) {
    resultsDiv.style.display = 'none';
    resultsDiv.innerHTML = '';
    return;
  }
  
  // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ÙƒÙ„ Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  const allData = [
    ...pricesData.map(i => ({...i, source: 'Ø´Ø§Ø´Ø§Øª', icon: 'ğŸ–¥ï¸'})),
    ...batteriesData.map(i => ({...i, source: 'Ø¨Ø·Ø§Ø±ÙŠØ§Øª', icon: 'ğŸ”‹'})),
    ...chargeboardsData.map(i => ({...i, source: 'Ø¨ÙˆØ±Ø¯ Ø´Ø­Ù†', icon: 'ğŸ”Œ'})),
    ...flatchargingData.map(i => ({...i, source: 'Ø´Ø±ÙŠØ· Ø´Ø­Ù†', icon: 'âš¡'})),
    ...flatpowerData.map(i => ({...i, source: 'ÙÙ„Ø§Øª Ø¨ÙˆØ±/ØµÙˆØª', icon: 'ğŸ”Š'})),
    ...backcoverData.map(i => ({...i, source: 'Ø¨Ø§Ùƒ ÙƒÙØ±', icon: 'ğŸ“±'})),
    ...housingData.map(i => ({...i, source: 'Ø´Ø§ØµÙŠ', icon: 'ğŸ '})),
    ...cameraData.map(i => ({...i, source: 'ÙƒØ§Ù…ÙŠØ±Ø§', icon: 'ğŸ“·'})),
    ...buzzerData.map(i => ({...i, source: 'Ø³Ù…Ø§Ø¹Ø© Ø¬Ø±Ø³', icon: 'ğŸ””'})),
    ...earSpeakerData.map(i => ({...i, source: 'Ø³Ù…Ø§Ø¹Ø© Ø§ØªØµØ§Ù„', icon: 'ğŸ“'})),
    ...doorSimData.map(i => ({...i, source: 'Ø¨Ø§Ø¨ Ø³ÙŠÙ…', icon: 'ğŸ’³'})),
    ...fingerprintData.map(i => ({...i, source: 'Ø¨ØµÙ…Ø©', icon: 'ğŸ‘†'})),
    ...lensData.map(i => ({...i, source: 'Ø¹Ø¯Ø³Ø© ÙƒØ§Ù…ÙŠØ±Ø§', icon: 'ğŸ“·'})),
    ...miscData.map(i => ({...i, source: 'Ù…Ù†ÙˆØ¹', icon: 'ğŸ“¦'}))
  ];
  
  const results = allData.filter(item => 
    (item.name && item.name.toLowerCase().includes(query)) ||
    (item.brand && item.brand.toLowerCase().includes(query))
  );
  
  resultsDiv.style.display = 'block';
  
  if (results.length === 0) {
    resultsDiv.innerHTML = '<div style="padding:12px;color:#666;text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
    return;
  }
  
  let html = `<div style="font-weight:bold;color:#1e88e5;margin-bottom:8px;">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (${results.length}):</div>`;
  
  results.slice(0, 20).forEach(item => {
    const price = Number(String(item.price || '').replace(/[^0-9]/g, '')) || 0;
    const qty = Number(item.qty) || 0;
    const available = qty > 0 && price > 0;
    const priceText = available ? formatPriceIQD(price) + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
    const priceColor = available ? '#1e88e5' : '#c62828';
    
    // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø´Ø§Ø´Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø§Øª
    let screenTypeLabel = '';
    if (item.source === 'Ø´Ø§Ø´Ø§Øª' && item.type) {
      const typeLabels = {
        'Ø£ØµÙ„ÙŠ ÙˆÙƒØ§Ù„Ø©': 'ğŸŸ¢',
        'Ø£ØµÙ„ÙŠ ØµÙŠÙ†ÙŠ': 'ğŸ”µ', 
        'TFT': 'ğŸŸ¡'
      };
      const icon = typeLabels[item.type] || '';
      screenTypeLabel = `<span style="background:#e8f5e9;color:#2e7d32;padding:3px 8px;border-radius:6px;font-size:11px;font-weight:bold;margin-right:6px;display:inline-block;">${icon} ${item.type}</span>`;
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯Ø©
    let notesHtml = '';
    if (item.notes && item.notes.trim()) {
      notesHtml = `<div style="background:#fff3e0;border-right:3px solid #ff9800;padding:6px 10px;margin-top:6px;border-radius:4px;font-size:12px;color:#e65100;">ğŸ“ ${item.notes}</div>`;
    }
    
    // Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
    const cartBtn = available 
      ? `<button onclick='addToCartFromSearch(${JSON.stringify(item).replace(/'/g, "&#39;")})' style="background:#25D366;color:white;padding:8px 16px;border-radius:8px;border:none;cursor:pointer;margin-top:8px;width:100%;font-weight:bold;font-size:14px;">ğŸ›’ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>` 
      : '';
    
    html += `
      <div style="background:#f9fbff;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #e0e8f0;">
        <div style="font-weight:bold;font-size:14px;color:#1e3a5f;">
          ${item.icon} ${item.name}
        </div>
        <div style="font-size:12px;color:#666;margin-top:4px;">
          Ø§Ù„Ù‚Ø³Ù…: ${item.source} â€¢ Ø§Ù„Ù…Ø§Ø±ÙƒØ©: ${item.brand || '-'}
        </div>
        ${screenTypeLabel ? `<div style="margin-top:6px;">${screenTypeLabel}</div>` : ''}
        ${notesHtml}
        <div style="font-size:13px;color:${priceColor};font-weight:bold;margin-top:4px;">
          ${priceText}
        </div>
        ${cartBtn}
      </div>
    `;
  });
  
  if (results.length > 20) {
    html += `<div style="padding:8px;color:#666;text-align:center;font-size:13px;">... Ùˆ ${results.length - 20} Ù†ØªÙŠØ¬Ø© Ø£Ø®Ø±Ù‰</div>`;
  }
  
  resultsDiv.innerHTML = html;
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø© Ù…Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
function addToCartFromSearch(product) {
  const user = JSON.parse(localStorage.getItem('amwaj_user') || 'null');
  if (!user) {
    alert('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
    showLoginPage();
    return;
  }
  
  // ØªØ­Ø¯ÙŠØ¯ itemType Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØµØ¯Ø±
  const sourceTypeMap = {
    'Ø´Ø§Ø´Ø§Øª': 'screens',
    'Ø¨Ø·Ø§Ø±ÙŠØ§Øª': 'batteries',
    'Ø¨ÙˆØ±Ø¯ Ø´Ø­Ù†': 'chargeboards',
    'Ø´Ø±ÙŠØ· Ø´Ø­Ù†': 'flatcharging',
    'ÙÙ„Ø§Øª Ø¨ÙˆØ±/ØµÙˆØª': 'flatpower',
    'Ø¨Ø§Ùƒ ÙƒÙØ±': 'backcover',
    'Ø´Ø§ØµÙŠ': 'housing',
    'ÙƒØ§Ù…ÙŠØ±Ø§': 'camera',
    'Ø³Ù…Ø§Ø¹Ø© Ø¬Ø±Ø³': 'flatpower',
    'Ø³Ù…Ø§Ø¹Ø© Ø§ØªØµØ§Ù„': 'flatpower',
    'Ø¨Ø§Ø¨ Ø³ÙŠÙ…': 'flatpower',
    'Ø¨ØµÙ…Ø©': 'flatpower',
    'Ø¹Ø¯Ø³Ø© ÙƒØ§Ù…ÙŠØ±Ø§': 'lens',
    'Ù…Ù†ÙˆØ¹': 'flatpower'
  };
  
  product.itemType = sourceTypeMap[product.source] || 'screens';
  
  // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© addToCart Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
  addToCart(product);
}

// ==================== Ø¨Ø­Ø« Google (Ù†ØµÙŠ ÙˆØµÙˆØ±ÙŠ) ====================
function searchGoogle() {
  const query = document.getElementById('googleTextSearch').value.trim();
  if (!query) {
    alert('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ù„Ù„Ø¨Ø­Ø«');
    return;
  }
  
  // ÙØªØ­ Google ÙÙŠ ØªØ§Ø¨ Ø¬Ø¯ÙŠØ¯
  const googleUrl = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
  window.open(googleUrl, '_blank');
  
  // Ø¥ÙØ±Ø§Øº Ø§Ù„Ø­Ù‚Ù„
  document.getElementById('googleTextSearch').value = '';
}

function searchGoogleByImage(input) {
  const file = input.files[0];
  const statusDiv = document.getElementById('imageSearchStatus');
  
  if (!file) {
    statusDiv.textContent = '';
    return;
  }
  
  if (!file.type.startsWith('image/')) {
    statusDiv.textContent = 'âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©';
    return;
  }
  
  statusDiv.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„ØµÙˆØ±Ø©...';
  
  // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ base64
  const reader = new FileReader();
  reader.onload = function(e) {
    // Google Lens URL - ÙŠÙØªØ­ ØµÙØ­Ø© Ø±ÙØ¹ ØµÙˆØ±Ø©
    // Ù„Ù„Ø£Ø³Ù Google Lens Ù…Ø§ Ø¹Ù†Ø¯Ù‡ API Ù…Ø¨Ø§Ø´Ø±ØŒ Ø¨Ø³ Ù†Ù‚Ø¯Ø± Ù†ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„ØµÙˆØ±Ø©
    const googleLensUrl = 'https://lens.google.com/uploadbyurl?url=';
    
    // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©: Ù†Ø³ØªØ®Ø¯Ù… Google Images reverse search
    // Ù†ÙØªØ­ ØµÙØ­Ø© Google Images ÙˆÙ†Ø®Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹
    const googleImagesUrl = 'https://images.google.com/';
    
    statusDiv.textContent = 'âœ… Ø§ÙØªØ­ Google Images â† Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ğŸ“· â† Ø§Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©';
    
    window.open(googleImagesUrl, '_blank');
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† input
    input.value = '';
    
    setTimeout(() => {
      statusDiv.textContent = '';
    }, 5000);
  };
  
  reader.onerror = function() {
    statusDiv.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø©';
  };
  
  reader.readAsDataURL(file);
}

// ==================== auto login ====================
async function checkAutoLogin() {
  showPage("loadingPage");
  const savedPhone = localStorage.getItem("amwaj_phone");
  if (savedPhone) {
    try {
      const rows = await fetchCustomers();
      const user = rows.find(r => normalizePhone(r.phone) === savedPhone);
      if (user && user.status === "approved") { localStorage.setItem("amwaj_user", JSON.stringify(user)); document.getElementById("welcomeUser").innerHTML = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name} ğŸ‘‹<br><small>${user.shop}</small>`; showPage("homePage"); return; }
      else if (user && user.status === "pending") { document.getElementById("loginPhone").value = savedPhone; showPage("loginPage"); document.getElementById("loginResult").innerHTML = '<div class="result pending">â³ Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©<br>Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</div>'; return; }
      else if (user && user.status === "rejected") { localStorage.removeItem("amwaj_phone"); localStorage.removeItem("amwaj_user"); showPage("loginPage"); return; }
      else { localStorage.removeItem("amwaj_phone"); localStorage.removeItem("amwaj_user"); showPage("registerPage"); return; }
    } catch (e) { console.error(e); showPage("registerPage"); return; }
  }
  showPage("registerPage");
}

// ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¶Ù…Ø§Ù† ====================
function formatDate(d) {
  let x = new Date(d);
  return String(x.getDate()).padStart(2, '0') + "/" + String(x.getMonth() + 1).padStart(2, '0') + "/" + x.getFullYear();
}

let usedInvoices = new Set();

async function sendData() {
  const btn = document.getElementById("btnActivate");
  const result = document.getElementById("result");
  const dupMsg = document.getElementById("dupMsg");
  btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„â€¦"; dupMsg.style.display = "none";
  try {
    let name = document.getElementById("name").value.trim();
    let phone = document.getElementById("phone").value.trim();
    let screenName = document.getElementById("screenName").value.trim();
    let invoice = normalizeNumber(document.getElementById("invoice").value.trim());
    let screenCode = normalizeNumber(document.getElementById("screenCode").value).trim().toUpperCase();
    let type = document.getElementById("type").value;
    let start = document.getElementById("start").value;
    if (!name || !phone || !invoice || !screenCode) { alert("Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„"); throw "stop"; }
    if (usedInvoices.has(screenCode)) { dupMsg.innerText = "âš ï¸ ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹"; dupMsg.style.display = "block"; throw "stop"; }
    const warranties = await secureApiCall('getWarranties');
    if (warranties.find(w => normalizeNumber(String(w.screencode || "")).trim().toUpperCase() === screenCode)) { dupMsg.innerText = "âš ï¸ ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹"; dupMsg.style.display = "block"; throw "stop"; }
    let days = type === "screen" ? 30 : 365;
    let [d, m, y] = start.split("/");
    let end = new Date(y, m - 1, d); end.setDate(end.getDate() + days - 1);
    let remaining = Math.ceil((end - new Date()) / (1000 * 60 * 60 * 24));
    result.className = "result success"; result.style.display = "block";
    result.innerHTML = `âœ”ï¸ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†<br>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: <b>${formatDate(end)}</b><br>â³ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <b>${remaining}</b> ÙŠÙˆÙ…<div style="margin-top:10px;padding:8px 12px;background:#fff3cd;color:#856404;border-radius:8px;font-size:14px;">âš ï¸ Ø§Ù„Ø¶Ù…Ø§Ù† Ù„Ø§ ÙŠØ´Ù…Ù„ Ø§Ù„ÙƒØ³Ø±ØŒ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ØŒ Ø£Ùˆ Ø§Ù„ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø®Ø§Ø·Ø¦<br>Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¬Ø²Ø¡ Ù…Ù† Ø¶Ù…Ø§Ù†ÙƒÙ…ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù‡Ø§</div><div style="margin-top:10px;padding:8px;background:#e3f2fd;color:#1565c0;border-radius:8px;font-size:13px;">Ø³ÙŠØªÙ… Ø¥ÙØ±Ø§Øº Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„...</div>`;
    await secureApiCall('addWarranty', { name, phone, invoice, screenCode, screenName, type, start, end: formatDate(end) });
    usedInvoices.add(screenCode); 
    
    setTimeout(() => {
      document.getElementById("name").value = "";
      document.getElementById("phone").value = "";
      document.getElementById("invoice").value = "";
      document.getElementById("screenCode").value = "";
      document.getElementById("screenName").value = "";
      document.getElementById("start").value = "";
      result.innerHTML = "";
      btn.innerText = "ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†";
      btn.disabled = false;
    }, 30000);
  } catch (e) { if (e !== "stop") console.error(e); btn.innerText = "ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†"; btn.disabled = false; }
}

// ==================== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¶Ù…Ø§Ù† ====================
async function checkWarranty() {
  let v = normalizeNumber(document.getElementById("inv").value).trim().toUpperCase();
  let out = document.getElementById("out");
  if (!v) { alert("Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©"); return; }
  out.innerHTML = '<div class="result pending">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</div>';
  try {
    const warranties = await secureApiCall('getWarranties');
    const r = warranties.find(w => normalizeNumber(String(w.screencode || "")).trim().toUpperCase() === v);

    if (r) {
      let expiryDate = null;
      let startDate = null;

      if (r.start_date) {
        if (typeof r.start_date === 'string' && r.start_date.includes('/')) {
          let [d, m, y] = r.start_date.split("/");
          startDate = new Date(y, m - 1, d);
        } else if (typeof r.start_date === 'number') {
          startDate = new Date((r.start_date - 25569) * 86400 * 1000);
        } else {
          startDate = new Date(r.start_date);
        }
      }

      if (r.expiry) {
        if (typeof r.expiry === 'string' && r.expiry.includes('/')) {
          let [d, m, y] = r.expiry.split("/");
          expiryDate = new Date(y, m - 1, d);
        } else if (typeof r.expiry === 'number') {
          expiryDate = new Date((r.expiry - 25569) * 86400 * 1000);
        } else {
          expiryDate = new Date(r.expiry);
        }
      }

      let remaining = expiryDate ? Math.ceil((expiryDate - new Date()) / (1000 * 60 * 60 * 24)) : null;
      let startDateStr = startDate ? formatDate(startDate) : (r.start_date || "-");
      let endDateStr = expiryDate ? formatDate(expiryDate) : (r.expiry || "-");

      out.innerHTML = `
        <div class="result ${remaining !== null && remaining >= 0 ? 'success' : 'error'}">
          ${remaining !== null && remaining >= 0 ? 'âœ”ï¸ Ø§Ù„Ø¶Ù…Ø§Ù† Ù…ÙˆØ¬ÙˆØ¯ ÙˆØ³Ø§Ø±ÙŠ' : 'âŒ Ø§Ù„Ø¶Ù…Ø§Ù† Ù…Ù†ØªÙ‡ÙŠ'}<br>
          Ø§Ù„Ø§Ø³Ù…: ${r.name || "-"}<br>
          Ø§Ù„Ù‡Ø§ØªÙ: ${r.phone || "-"}<br>
          Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø´Ø©: ${r.screenname || "-"}<br>
          Ø§Ù„Ù†ÙˆØ¹: ${r.type || "-"}<br>
          ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡: ${startDateStr}<br>
          ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: ${endDateStr}<br>
          ${remaining !== null && remaining >= 0 ? `â³ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <b>${remaining}</b> ÙŠÙˆÙ…` : 'â›” Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¶Ù…Ø§Ù† ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¬Ø¯ÙŠØ¯Ù‡'}
        </div>`;
    } else {
      out.innerHTML = '<div class="result error">âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©</div>';
    }
  } catch (e) { console.error(e); out.innerHTML = '<div class="result error">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message + '</div>'; }
}

// ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ====================
let pricesData = [];
let batteriesData = [];
let chargeboardsData = [];
let flatchargingData = [];
let flatpowerData = [];
let backcoverData = [];
let housingData = [];
let lensData = [];
let cameraData = [];
let buzzerData = [];
let earSpeakerData = [];
let doorSimData = [];
let fingerprintData = [];
let miscData = [];

async function loadPrices() {
  try { 
    pricesData = await secureApiCall('getPrices'); 
    console.log("âœ… Screens loaded:", pricesData.length); 
  }
  catch (e) { console.error("Error loading screens:", e); }
}

async function loadBatteries() {
  try {
    const rawData = await secureApiCall('getBatteries');
    batteriesData = rawData.map(item => ({
      ...item,
      brand: extractBrand(item.name || item.Ø§Ù„Ø§Ø³Ù…),
      type: 'Ø¨Ø·Ø§Ø±ÙŠØ©',
      name: item.name || item.Ø§Ù„Ø§Ø³Ù… || '-',
      price: item.price || item.Ø§Ù„Ø³Ø¹Ø± || 0,
      qty: item.qty || item.Ø§Ù„Ø¹Ø¯Ø¯ || 0,
      notes: item.notes || item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''
    }));
    console.log("âœ… Batteries loaded:", batteriesData.length);
  } catch (e) { console.error("Error loading batteries:", e); }
}

async function loadChargeboards() {
  try {
    const rawData = await secureApiCall('getChargeboards');
    chargeboardsData = rawData.map(item => ({
      ...item,
      brand: extractBrand(item.name || item.Ø§Ù„Ø§Ø³Ù…),
      type: 'Ø¨ÙˆØ±Ø¯ Ø´Ø­Ù†',
      name: item.name || item.Ø§Ù„Ø§Ø³Ù… || '-',
      price: item.price || item.Ø§Ù„Ø³Ø¹Ø± || 0,
      qty: item.qty || item.Ø§Ù„Ø¹Ø¯Ø¯ || 0,
      notes: item.notes || item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''
    }));
    console.log("âœ… Charge boards loaded:", chargeboardsData.length);
  } catch (e) { console.error("Error loading charge boards:", e); }
}

async function loadFlatMain() {
  try {
    const rawData = await secureApiCall('getFlatMain');
    
    const allFlatData = rawData.map(item => ({
      ...item,
      brand: extractBrand(item.name || item.Ø§Ù„Ø§Ø³Ù…),
      name: item.name || item.Ø§Ù„Ø§Ø³Ù… || '-',
      price: item.price || item.Ø§Ù„Ø³Ø¹Ø± || 0,
      qty: item.qty || item.Ø§Ù„Ø¹Ø¯Ø¯ || 0,
      notes: item.notes || item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''
    }));
    
    // Ø´Ø±ÙŠØ· Ø´Ø­Ù† + Ø´Ø§Ø´Ø©: ÙÙ‚Ø· LCD Ùˆ MAIN
    flatchargingData = allFlatData.filter(item => {
      const nameUpper = item.name.toUpperCase();
      return nameUpper.includes('FLAT LCD') || nameUpper.includes('FLAT MAIN');
    }).map(item => ({...item, type: 'Ø´Ø±ÙŠØ· Ø´Ø­Ù†/Ø´Ø§Ø´Ø©'}));
    
    // Ø´Ø±ÙŠØ· Ø¨ÙˆØ± + ØµÙˆØª + Ù…Ù†ÙˆØ¹Ø©: ÙƒÙ„ Ø§Ù„Ø¨Ø§Ù‚ÙŠ
    flatpowerData = allFlatData.filter(item => {
      const nameUpper = item.name.toUpperCase();
      return !nameUpper.includes('FLAT LCD') && !nameUpper.includes('FLAT MAIN');
    }).map(item => ({...item, type: 'Ø´Ø±ÙŠØ· Ø¨ÙˆØ±/ØµÙˆØª/Ù…Ù†ÙˆØ¹Ø©'}));
    
    console.log("âœ… Flat charging loaded:", flatchargingData.length);
    console.log("âœ… Flat power loaded:", flatpowerData.length);
  } catch (e) { console.error("Error loading flat main:", e); }
}

async function loadBackCover() {
  try {
    const rawData = await secureApiCall('getBackCover');
    backcoverData = rawData.map(item => ({
      ...item,
      brand: extractBrand(item.name || item.Ø§Ù„Ø§Ø³Ù…),
      type: 'Ø¨Ø§Ùƒ ÙƒÙØ±',
      name: item.name || item.Ø§Ù„Ø§Ø³Ù… || '-',
      price: item.price || item.Ø§Ù„Ø³Ø¹Ø± || 0,
      qty: item.qty || item.Ø§Ù„Ø¹Ø¯Ø¯ || 0,
      notes: item.notes || item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''
    }));
    console.log("âœ… Back cover loaded:", backcoverData.length);
  } catch (e) { console.error("Error loading back cover:", e); }
}

async function loadHousing() {
  try {
    const rawData = await secureApiCall('getHousing');
    housingData = rawData.map(item => ({
      ...item,
      brand: extractBrand(item.name || item.Ø§Ù„Ø§Ø³Ù…),
      type: 'Ø´Ø§ØµÙŠ',
      name: item.name || item.Ø§Ù„Ø§Ø³Ù… || '-',
      price: item.price || item.Ø§Ù„Ø³Ø¹Ø± || 0,
      qty: item.qty || item.Ø§Ù„Ø¹Ø¯Ø¯ || 0,
      notes: item.notes || item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''
    }));
    console.log("âœ… Housing loaded:", housingData.length);
  } catch (e) { console.error("Error loading housing:", e); }
}

async function loadLens() {
  try {
    const rawData = await secureApiCall('getLens');
    lensData = rawData.map(item => ({
      ...item,
      brand: extractBrand(item.name || item.Ø§Ù„Ø§Ø³Ù…),
      type: 'Ø¹Ø¯Ø³Ø© ÙƒØ§Ù…ÙŠØ±Ø§',
      name: item.name || item.Ø§Ù„Ø§Ø³Ù… || '-',
      price: item.price || item.Ø§Ù„Ø³Ø¹Ø± || 0,
      qty: item.qty || item.Ø§Ù„Ø¹Ø¯Ø¯ || 0,
      notes: item.notes || item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''
    }));
    console.log("âœ… Lens loaded:", lensData.length);
  } catch (e) { console.error("Error loading lens:", e); }
}

async function loadCamera() {
  try {
    const rawData = await secureApiCall('getCamera');
    cameraData = rawData.map(item => ({
      ...item,
      brand: extractBrand(item.name || item.Ø§Ù„Ø§Ø³Ù…),
      type: 'ÙƒØ§Ù…ÙŠØ±Ø§',
      name: item.name || item.Ø§Ù„Ø§Ø³Ù… || '-',
      price: item.price || item.Ø§Ù„Ø³Ø¹Ø± || 0,
      qty: item.qty || item.Ø§Ù„Ø¹Ø¯Ø¯ || 0,
      notes: item.notes || item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''
    }));
    console.log("âœ… Camera loaded:", cameraData.length);
  } catch (e) { console.error("Error loading camera:", e); }
}

async function loadBuzzer() {
  try {
    const rawData = await secureApiCall('getBuzzer');
    buzzerData = rawData.map(item => ({
      ...item,
      brand: extractBrand(item.name || item.Ø§Ù„Ø§Ø³Ù…),
      type: 'Ø³Ù…Ø§Ø¹Ø© Ø¬Ø±Ø³',
      name: item.name || item.Ø§Ù„Ø§Ø³Ù… || '-',
      price: item.price || item.Ø§Ù„Ø³Ø¹Ø± || 0,
      qty: item.qty || item.Ø§Ù„Ø¹Ø¯Ø¯ || 0,
      notes: item.notes || item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''
    }));
    console.log("âœ… Buzzer loaded:", buzzerData.length);
  } catch (e) { console.error("Error loading buzzer:", e); }
}

async function loadEarSpeaker() {
  try {
    const rawData = await secureApiCall('getEarSpeaker');
    earSpeakerData = rawData.map(item => ({
      ...item,
      brand: extractBrand(item.name || item.Ø§Ù„Ø§Ø³Ù…),
      type: 'Ø³Ù…Ø§Ø¹Ø© Ø§ØªØµØ§Ù„',
      name: item.name || item.Ø§Ù„Ø§Ø³Ù… || '-',
      price: item.price || item.Ø§Ù„Ø³Ø¹Ø± || 0,
      qty: item.qty || item.Ø§Ù„Ø¹Ø¯Ø¯ || 0,
      notes: item.notes || item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''
    }));
    console.log("âœ… Ear Speaker loaded:", earSpeakerData.length);
  } catch (e) { console.error("Error loading ear speaker:", e); }
}

async function loadDoorSim() {
  try {
    const rawData = await secureApiCall('getDoorSim');
    doorSimData = rawData.map(item => ({
      ...item,
      brand: extractBrand(item.name || item.Ø§Ù„Ø§Ø³Ù…),
      type: 'Ø¨Ø§Ø¨ Ø³ÙŠÙ… ÙƒØ§Ø±Øª',
      name: item.name || item.Ø§Ù„Ø§Ø³Ù… || '-',
      price: item.price || item.Ø§Ù„Ø³Ø¹Ø± || 0,
      qty: item.qty || item.Ø§Ù„Ø¹Ø¯Ø¯ || 0,
      notes: item.notes || item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''
    }));
    console.log("âœ… Door Sim loaded:", doorSimData.length);
  } catch (e) { console.error("Error loading door sim:", e); }
}

async function loadFingerprint() {
  try {
    const rawData = await secureApiCall('getFingerprint');
    fingerprintData = rawData.map(item => ({
      ...item,
      brand: extractBrand(item.name || item.Ø§Ù„Ø§Ø³Ù…),
      type: 'Ø¨ØµÙ…Ø©',
      name: item.name || item.Ø§Ù„Ø§Ø³Ù… || '-',
      price: item.price || item.Ø§Ù„Ø³Ø¹Ø± || 0,
      qty: item.qty || item.Ø§Ù„Ø¹Ø¯Ø¯ || 0,
      notes: item.notes || item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''
    }));
    console.log("âœ… Fingerprint loaded:", fingerprintData.length);
  } catch (e) { console.error("Error loading fingerprint:", e); }
}

async function loadMisc() {
  try {
    const rawData = await secureApiCall('getMisc');
    miscData = rawData.map(item => ({
      ...item,
      brand: extractBrand(item.name || item.Ø§Ù„Ø§Ø³Ù…),
      type: 'Ù…Ù†ÙˆØ¹',
      name: item.name || item.Ø§Ù„Ø§Ø³Ù… || '-',
      price: item.price || item.Ø§Ù„Ø³Ø¹Ø± || 0,
      qty: item.qty || item.Ø§Ù„Ø¹Ø¯Ø¯ || 0,
      notes: item.notes || item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''
    }));
    console.log("âœ… Misc loaded:", miscData.length);
  } catch (e) { console.error("Error loading misc:", e); }
}

function formatPriceIQD(n) {
  let priceStr = String(n || '').replace(/\s/g, '').replace(/,/g, '').replace(/\./g, '');
  return (Number(priceStr) || 0).toLocaleString("de-DE");
}

function createPriceItem(p) {
  let priceStr = String(p.price || '').replace(/\s/g, '').replace(/,/g, '').replace(/\./g, '');
  const price = Number(priceStr) || 0;
  const qty = Number(p.qty) || 0;
  const notes = p.notes || '';
  
  const availableText = qty > 0 && price > 0 
    ? `<span style="color:#1e88e5;font-weight:bold">${formatPriceIQD(price)} Ø¯.Ø¹</span>` 
    : `<span style="color:#c62828;font-weight:bold">ØºÙŠØ± Ù…ØªÙˆÙØ±</span>`;
  
  const notesText = notes ? `<div style="margin-top:6px;background:#fff3cd;padding:10px 12px;border-radius:8px;font-size:15px;font-weight:600;color:#856404;border-left:4px solid #ffc107;">ğŸ“ ${notes}</div>` : '';
  
  const typeText = currentPriceType === 'screens' && p.type ? `<div style="margin-top:4px"><b>Ø§Ù„Ù†ÙˆØ¹:</b> ${p.type}</div>` : '';
  
  const cartBtn = qty > 0 && price > 0 
    ? `<button class="add-to-cart-btn" onclick='addToCart(${JSON.stringify(p).replace(/'/g, "&#39;")})'>ğŸ›’ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>` 
    : '';
  
  return `<div class="price-item" style="padding:12px;border:1px solid #ccc;margin:8px 0;border-radius:10px;background:#f9fbff">
    <div style="font-weight:bold;font-size:16px;color:#1e3a5f">
      <div style="margin-top:4px"><b>Ø§Ù„Ù…Ø§Ø±ÙƒØ©:</b> ${p.brand || "-"}</div>
      <div style="margin-top:4px"><b>Ø§Ù„Ø§Ø³Ù…:</b> ${p.name || "-"}</div>
      ${typeText}
      <div style="margin-top:4px"><b>Ø§Ù„Ø³Ø¹Ø±:</b> ${availableText}</div>
      ${notesText}
    </div>
    ${cartBtn}
  </div>`;
}

function openBrand(el) {
  const brands = el.dataset.brand.split(",").map(b => b.trim());
  document.getElementById("brandsSection").style.display = "none";
  document.getElementById("brandPrices").style.display = "block";
  const box = document.getElementById("brandPricesBox");
  
  showBackButton();
  
  box.innerHTML = `<div style="text-align:center;padding:40px 20px;"><div class="loading-spinner"></div><div style="color:#1e88e5;font-size:16px;margin-top:15px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±...</div></div>`;
  
  const searchInput = document.getElementById("searchInput"); 
  searchInput.value = "";
  
  // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: Ø¥Ø°Ø§ flatpower Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙÙ„ØªØ± Ø§Ù„ÙØ±Ø¹ÙŠ
  const checkPrices = () => {
    let dataToUse;
    if (currentPriceType === 'flatpower' && currentFlatSubType) {
      dataToUse = getFlatSubData(currentFlatSubType);
    } else {
      dataToUse = getDataForType(currentPriceType);
    }
    
    if (dataToUse.length === 0) {
      setTimeout(checkPrices, 500);
      return;
    }
    
    box.innerHTML = `<h3 style="color:#1e88e5;margin:10px 0;">Ø£Ø³Ø¹Ø§Ø± ${brands.join(" / ")}</h3>`;
    
    searchInput.oninput = function() {
      const q = this.value.trim().toLowerCase();
      box.querySelectorAll(".price-item").forEach(item => { 
        item.style.display = item.innerText.toLowerCase().includes(q) ? "block" : "none"; 
      });
    };
    
    const filtered = dataToUse.filter(p => 
      brands.map(b => b.toLowerCase()).includes((p.brand || "").toLowerCase())
    );
    
    if (filtered.length === 0) { 
      box.innerHTML += "<div style='padding:20px;text-align:center;color:#666;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¹Ø§Ø±</div>"; 
      return; 
    }
    
    filtered.forEach(p => { box.innerHTML += createPriceItem(p); });
  };
  
  checkPrices();
}

function backToBrands() { 
  document.getElementById("brandPrices").style.display = "none"; 
  document.getElementById("brandsSection").style.display = "block"; 
}

// ==================== Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù„Ø© ====================
let cart = [];

function loadCart() {
  const saved = localStorage.getItem('amwaj_cart');
  if (saved) {
    cart = JSON.parse(saved);
    updateCartBadge();
  }
}

function saveCart() {
  localStorage.setItem('amwaj_cart', JSON.stringify(cart));
  updateCartBadge();
}

function updateCartBadge() {
  const badge = document.getElementById('cartBadge');
  const count = document.getElementById('cartCount');
  
  if (cart.length > 0) {
    badge.style.display = 'flex';
    count.textContent = cart.length;
  } else {
    badge.style.display = 'none';
  }
}

function addToCart(product) {
  const user = JSON.parse(localStorage.getItem('amwaj_user') || 'null');
  if (!user) {
    alert('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
    showLoginPage();
    return;
  }
  
  if (!product.itemType) {
    product.itemType = currentPriceType;
  }
  
  const price = Number(String(product.price || '').replace(/[^0-9]/g, '')) || 0;
  const existingIndex = cart.findIndex(item => {
    const itemPrice = Number(String(item.price || '').replace(/[^0-9]/g, '')) || 0;
    return item.name === product.name && 
           itemPrice === price && 
           (item.notes || '') === (product.notes || '');
  });
  
  if (existingIndex !== -1) {
    cart[existingIndex].quantity = (cart[existingIndex].quantity || 1) + 1;
  } else {
    product.quantity = 1;
    cart.push(product);
  }
  
  saveCart();
  
  const msg = document.createElement('div');
  msg.style.cssText = 'position:fixed;top:80px;left:50%;transform:translateX(-50%);background:#25D366;color:white;padding:12px 20px;border-radius:8px;z-index:9999;box-shadow:0 4px 12px rgba(0,0,0,0.3);';
  msg.textContent = 'âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©';
  document.body.appendChild(msg);
  setTimeout(() => msg.remove(), 2000);
}

function removeFromCart(index) {
  cart.splice(index, 1);
  saveCart();
  renderCart();
}

function clearCart() {
  if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©ØŸ')) {
    cart = [];
    saveCart();
    renderCart();
  }
}

function openCart() {
  const user = JSON.parse(localStorage.getItem('amwaj_user') || 'null');
  if (!user) {
    alert('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
    showLoginPage();
    return;
  }
  
  showPage('cartPage');
  showBackButton();
  renderCart();
  
  document.getElementById('orderName').value = user.name || '';
  document.getElementById('orderShop').value = user.shop || '';
  
  const savedAddress = localStorage.getItem('amwaj_address');
  if (savedAddress) {
    document.getElementById('orderAddress').value = savedAddress;
  }
}

function closeCart() {
  showPage('pricesPage');
}

function renderCart() {
  const container = document.getElementById('cartItems');
  const totalEl = document.getElementById('cartTotal');
  const summaryDiv = document.getElementById('cartSummary');
  const orderForm = document.getElementById('orderForm');
  const clearBtn = document.getElementById('clearCartBtn');
  
  if (cart.length === 0) {
    container.innerHTML = '<div style="text-align:center;padding:40px;color:#666;"><div style="font-size:48px;margin-bottom:10px;">ğŸ›’</div><div>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div></div>';
    summaryDiv.style.display = 'none';
    orderForm.style.display = 'none';
    clearBtn.style.display = 'none';
    return;
  }
  
  summaryDiv.style.display = 'block';
  orderForm.style.display = 'block';
  clearBtn.style.display = 'block';
  
  let total = 0;
  container.innerHTML = '';
  
  cart.forEach((item, index) => {
    const price = Number(String(item.price || '').replace(/[^0-9]/g, '')) || 0;
    const quantity = item.quantity || 1;
    const itemTotal = price * quantity;
    total += itemTotal;
    
    const notesHtml = item.notes ? `<div style="background:#fff3cd;padding:10px 15px;border-radius:10px;font-size:15px;color:#856404;margin-top:8px;font-weight:600;border-left:4px solid #ffc107;">ğŸ“ ${item.notes}</div>` : '';
    
    const warrantyChecked = item.hasWarranty ? 'checked' : '';
    
    const isScreen = item.itemType === 'screens';
    const warrantyBox = isScreen ? `
      <div style="margin-top:8px;">
        <div style="display:flex;align-items:center;gap:8px;padding:8px;background:#e8f5e9;border-radius:8px;">
          <input type="checkbox" id="warranty_${index}" ${warrantyChecked} onchange="toggleWarranty(${index})" style="width:20px;height:20px;cursor:pointer;">
          <label for="warranty_${index}" style="font-size:15px;font-weight:600;color:#2e7d32;cursor:pointer;margin:0;">Ù…Ø¹ Ø¶Ù…Ø§Ù† ğŸ›¡ï¸</label>
        </div>
        <div id="warrantyNote_${index}" style="display:${warrantyChecked ? 'block' : 'none'};background:#fff3cd;padding:10px 12px;border-radius:8px;font-size:14px;color:#856404;margin-top:8px;border-left:4px solid #ffc107;">
          âš ï¸ Ø¹Ù„Ù…Ø§ Ø§Ù† Ø³Ø¹Ø± Ø§Ù„Ø´Ø§Ø´Ø© ÙŠØªØºÙŠØ± Ø¹Ù†Ø¯ Ø·Ù„Ø¨ Ø§Ù„Ø¶Ù…Ø§Ù†
        </div>
      </div>
    ` : '';
    
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <div class="cart-item-info">
        <div style="font-weight:bold;font-size:15px;">${item.name || '-'}</div>
        <div style="font-size:13px;color:#000;margin-top:2px;font-weight:bold;">${item.brand || '-'}</div>
        ${item.itemType === 'screens' && item.type ? `<div style="font-size:12px;color:#000;margin-top:2px;font-weight:bold;">Ø§Ù„Ù†ÙˆØ¹: ${item.type}</div>` : ''}
        <div style="color:#1e88e5;font-weight:bold;margin-top:4px;font-size:14px;">Ø§Ù„Ø³Ø¹Ø±: ${formatPriceIQD(price)} Ø¯.Ø¹</div>
        ${notesHtml}
        ${warrantyBox}
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:10px;">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <span style="font-size:15px;font-weight:bold;color:#333;">Ø§Ù„Ø¹Ø¯Ø¯: ${quantity}</span>
            <div style="display:flex;align-items:center;gap:6px;">
              <button onclick="changeQuantity(${index}, -1)" style="background:#ff9800;color:white;border:none;padding:6px 10px;border-radius:5px;cursor:pointer;font-size:18px;font-weight:bold;min-width:35px;">â–</button>
              <button onclick="changeQuantity(${index}, 1)" style="background:#4caf50;color:white;border:none;padding:6px 10px;border-radius:5px;cursor:pointer;font-size:18px;font-weight:bold;min-width:35px;">â•</button>
            </div>
          </div>
          <div style="color:#1e88e5;font-weight:bold;font-size:15px;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${formatPriceIQD(itemTotal)} Ø¯.Ø¹</div>
        </div>
        <button onclick="removeFromCart(${index})" style="background:#f44336;color:white;border:none;padding:8px 20px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:bold;margin-top:10px;width:auto;box-shadow:0 2px 8px rgba(244,67,54,0.4);">Ø­Ø°Ù</button>
      </div>
    `;
    container.appendChild(div);
  });
  
  totalEl.textContent = formatPriceIQD(total) + ' Ø¯.Ø¹';
}

function changeQuantity(index, change) {
  if (!cart[index]) return;
  const newQty = (cart[index].quantity || 1) + change;
  if (newQty < 1) {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) { removeFromCart(index); }
    return;
  }
  if (newQty > 99) { alert('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 99 Ù‚Ø·Ø¹Ø©'); return; }
  cart[index].quantity = newQty;
  saveCart();
  renderCart();
}

function toggleWarranty(index) {
  if (!cart[index]) return;
  const checkbox = document.getElementById(`warranty_${index}`);
  const note = document.getElementById(`warrantyNote_${index}`);
  cart[index].hasWarranty = checkbox.checked;
  if (note) { note.style.display = checkbox.checked ? 'block' : 'none'; }
  saveCart();
}

async function submitOrder() {
  const user = JSON.parse(localStorage.getItem('amwaj_user') || 'null');
  if (!user) { alert('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„'); return; }
  
  const name = document.getElementById('orderName').value.trim();
  const shop = document.getElementById('orderShop').value.trim();
  const address = document.getElementById('orderAddress').value.trim();
  const result = document.getElementById('orderResult');
  
  if (!name || !shop || !address) { result.innerHTML = '<div class="result error">âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„</div>'; return; }
  if (cart.length === 0) { result.innerHTML = '<div class="result error">âŒ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>'; return; }
  
  const submitBtn = document.querySelector('#orderForm button[onclick="submitOrder()"]');
  const clearBtn = document.getElementById('clearCartBtn');
  submitBtn.disabled = true;
  if (clearBtn) clearBtn.disabled = true;
  
  localStorage.setItem('amwaj_address', address);
  
  let message = `ğŸ›’ *Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯*\n\n`;
  message += `ğŸ‘¤ *Ø§Ù„Ø§Ø³Ù…:* ${name}\n`;
  message += `ğŸª *Ø§Ù„Ù…Ø­Ù„:* ${shop}\n`;
  message += `ğŸ“± *Ø§Ù„Ù‡Ø§ØªÙ:* ${user.phone}\n`;
  message += `ğŸ“ *Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:* ${address}\n\n`;
  message += `*Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:*\n`;
  
  let total = 0;
  cart.forEach((item, i) => {
    const price = Number(String(item.price || '').replace(/[^0-9]/g, '')) || 0;
    const quantity = item.quantity || 1;
    const itemTotal = price * quantity;
    total += itemTotal;
    
    const isScreen = item.itemType === 'screens';
    
    message += `${i+1}. ${item.name} (${item.brand})\n`;
    message += `   Ø§Ù„Ù†ÙˆØ¹: ${item.type || '-'}\n`;
    message += `   Ø§Ù„Ø³Ø¹Ø±: ${formatPriceIQD(price)} Ø¯.Ø¹\n`;
    message += `   Ø§Ù„ÙƒÙ…ÙŠØ©: ${quantity}\n`;
    
    if (isScreen) {
      message += item.hasWarranty ? `   âœ… Ù…Ø¹ Ø¶Ù…Ø§Ù† ğŸ›¡ï¸ (Ø§Ù„Ø³Ø¹Ø± ÙŠØªØºÙŠØ±)\n` : `   âšª Ø¨Ø¯ÙˆÙ† Ø¶Ù…Ø§Ù†\n`;
    }
    
    message += `   Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${formatPriceIQD(itemTotal)} Ø¯.Ø¹\n`;
    if (item.notes) { message += `   ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø©: ${item.notes}\n`; }
  });
  
  message += `\nğŸ’° *Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:* ${formatPriceIQD(total)} Ø¯.Ø¹`;
  
  result.innerHTML = '<div class="result pending">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...</div>';
  
  try {
    const response = await fetch('https://api.greenapi.com/waInstance7103498677/sendMessage/9c30040e79424fd1afc33d7283cd3000d01f88d037204a3f9c', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ chatId: '9647709000160@c.us', message: message })
    });
    
    const data = await response.json();
    
    if (data.idMessage) {
      try {
        await secureApiCall('saveOrder', { name, shop, phone: user.phone, address, items: cart, total });
        console.log('âœ… Order saved to sheets');
      } catch (e) { console.error('âŒ Failed to save order:', e); }
      
      result.innerHTML = '<div class="result success">âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!<br>Ø³ÙŠØªÙ… ØªØ¬Ù‡ÙŠØ²Ù‡Ø§ Ù‚Ø±ÙŠØ¨Ø§Ù‹ ğŸ“¦<br><small style="color:#666;font-size:12px;">Ø³ÙŠØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³Ù„Ø© Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„...</small></div>';
      
      let customerMessage = `âœ… *ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­*\n\n`;
      customerMessage += `Ù…Ø±Ø­Ø¨Ø§Ù‹ *${name}*ØŒ\n\n`;
      customerMessage += `Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ Ù…Ù† Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª ğŸŒŠ\n\n`;
      customerMessage += `ğŸ“‹ *ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨Ùƒ:*\n\n`;
      
      cart.forEach((item, i) => {
        const price = Number(String(item.price || '').replace(/[^0-9]/g, '')) || 0;
        const quantity = item.quantity || 1;
        const itemTotal = price * quantity;
        const isScreen = item.itemType === 'screens';
        
        customerMessage += `${i+1}. ${item.name}\n`;
        customerMessage += `   Ø§Ù„Ù…Ø§Ø±ÙƒØ©: ${item.brand}\n`;
        customerMessage += `   Ø§Ù„Ù†ÙˆØ¹: ${item.type || '-'}\n`;
        customerMessage += `   Ø§Ù„Ø³Ø¹Ø±: ${formatPriceIQD(price)} Ø¯.Ø¹\n`;
        customerMessage += `   Ø§Ù„ÙƒÙ…ÙŠØ©: ${quantity}\n`;
        if (isScreen) { customerMessage += item.hasWarranty ? `   âœ… Ù…Ø¹ Ø¶Ù…Ø§Ù† ğŸ›¡ï¸ (Ø§Ù„Ø³Ø¹Ø± ÙŠØªØºÙŠØ±)\n` : `   âšª Ø¨Ø¯ÙˆÙ† Ø¶Ù…Ø§Ù†\n`; }
        customerMessage += `   Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${formatPriceIQD(itemTotal)} Ø¯.Ø¹\n`;
        if (item.notes) { customerMessage += `   ğŸ“ ${item.notes}\n`; }
        customerMessage += `\n`;
      });
      
      customerMessage += `ğŸ’° *Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:* ${formatPriceIQD(total)} Ø¯.Ø¹\n\n`;
      customerMessage += `ğŸ“ *Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„:* ${address}\n\n`;
      customerMessage += `ğŸ“ *Ù…Ù„Ø§Ø­Ø¸Ø©:* Ø³ÙŠØªÙ… ØªØ¬Ù‡ÙŠØ² Ø·Ù„Ø¨Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹\n\n`;
      customerMessage += `Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±:\nğŸ“ 7696\nğŸ“ 07709000160\n\n`;
      customerMessage += `Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€\n\nØ´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒÙ… ğŸŒŠ\n*Ø£Ù…ÙˆØ§Ø¬ Ù„Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª*`;
      
      fetch('https://api.greenapi.com/waInstance7103498677/sendMessage/9c30040e79424fd1afc33d7283cd3000d01f88d037204a3f9c', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chatId: user.phone.replace(/^0/, '964') + '@c.us', message: customerMessage })
      }).catch(err => console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯:', err));
      
      setTimeout(() => {
        cart = [];
        saveCart();
        result.innerHTML = '';
        submitBtn.disabled = false;
        if (clearBtn) clearBtn.disabled = false;
        if (document.getElementById('cartPage').style.display !== 'none') { renderCart(); } else { closeCart(); }
      }, 20000);
    } else {
      throw new Error('ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
    }
  } catch (e) {
    console.error(e);
    result.innerHTML = '<div class="result error">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>';
    submitBtn.disabled = false;
    if (clearBtn) clearBtn.disabled = false;
  }
}

// ==================== Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø§Ù„Ø¹Ø§Ø¦Ù… ====================
function backToBrands() {
  const brandsSection = document.getElementById("brandsSection");
  const brandPrices = document.getElementById("brandPrices");
  const cartPage = document.getElementById("cartPage");
  const btn = document.getElementById("backToTopBtn");
  
  if (cartPage.style.display === "block") {
    showPage("homePage");
    btn.style.display = "none";
  } else if (brandPrices.style.display === "block") {
    brandPrices.style.display = "none";
    brandsSection.style.display = "block";
    window.scrollTo({ top: 0, behavior: 'smooth' });
  } else if (brandsSection.style.display === "block") {
    // Ø¥Ø°Ø§ Ø¬Ø§ÙŠ Ù…Ù† flatpower submenuØŒ Ø§Ø±Ø¬Ø¹ Ù„Ù„Ù…ÙˆØ¯ÙŠÙ„
    if (currentFlatSubType) {
      showPage("homePage");
      btn.style.display = "none";
      // Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„
      // openFlatpowerModal();
    } else {
      showPage("homePage");
      btn.style.display = "none";
    }
  }
}

function showBackButton() {
  document.getElementById("backToTopBtn").style.display = "block";
}

function hideBackButton() {
  document.getElementById("backToTopBtn").style.display = "none";
}

// ==================== Swipe Gestures ====================
let touchStartX = 0;
let touchStartY = 0;
let touchEndX = 0;
let touchEndY = 0;

document.addEventListener('touchstart', function(e) {
  touchStartX = e.changedTouches[0].screenX;
  touchStartY = e.changedTouches[0].screenY;
}, false);

document.addEventListener('touchend', function(e) {
  touchEndX = e.changedTouches[0].screenX;
  touchEndY = e.changedTouches[0].screenY;
  handleSwipe();
}, false);

function handleSwipe() {
  const diffX = touchEndX - touchStartX;
  const diffY = touchEndY - touchStartY;
  
  if (Math.abs(diffX) > Math.abs(diffY)) {
    if (diffX < -50) {
      const brandsSection = document.getElementById("brandsSection");
      const brandPrices = document.getElementById("brandPrices");
      const cartPage = document.getElementById("cartPage");
      
      if (brandPrices && brandPrices.style.display === "block") { backToBrands(); }
      else if (brandsSection && brandsSection.style.display === "block") { backToBrands(); }
      else if (cartPage && cartPage.style.display === "block") { backToBrands(); }
      else if (!document.getElementById("homePage") || document.getElementById("homePage").style.display !== "block") { showPage("homePage"); }
    }
  }
}

// ==================== ØªØ´ØºÙŠÙ„ ====================
checkAutoLogin();
loadPrices();
loadBatteries();
loadChargeboards();
loadFlatMain();
loadBackCover();
loadHousing();
loadLens();
loadCamera();
loadBuzzer();
loadEarSpeaker();
loadDoorSim();
loadFingerprint();
loadMisc();
loadCart();

// ==================== PWA Service Worker ====================
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(registration => console.log('âœ… PWA: Service Worker registered'))
      .catch(err => console.log('âŒ PWA: Service Worker registration failed', err));
  });
}
</script>
</body>
</html>
